<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Á´∂È¶¨Âá∫È¶¨Ë°®„Éì„É•„Éº„Ç¢„Éº</title>
    <style>
        /* „É™„Çª„ÉÉ„Éà„Å®„Éô„Éº„ÇπË®≠ÂÆö */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            background-color: #f0f2f5;
            color: #1a1a1a;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }

        /* „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ */
        body.dark-mode {
            background-color: #1a1d29;
            color: #e0e0e0;
        }

        body.dark-mode .header {
            background: linear-gradient(135deg, #0f1419 0%, #1a1d29 100%);
        }

        body.dark-mode .race-selector,
        body.dark-mode .content-area,
        body.dark-mode .stat-group,
        body.dark-mode .filter-section,
        body.dark-mode .quick-view-section,
        body.dark-mode .comparison-section {
            background: #2a2d3a;
            color: #e0e0e0;
        }

        body.dark-mode .race-group {
            border-color: #3a3d4a;
        }

        body.dark-mode .race-group-header {
            background: #3a3d4a;
            border-color: #4a4d5a;
        }

        body.dark-mode .race-tab-button {
            background: #2a2d3a;
            color: #e0e0e0;
            border-color: #4a4d5a;
        }

        body.dark-mode .summary-card {
            background: #3a3d4a;
        }

        body.dark-mode .sub-tabs {
            background: #2a2d3a;
            border-color: #3a3d4a;
        }

        /* „Ç≥„É≥„ÉÜ„Éä - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .container {
            width: 100%;
            max-width: 100%;
            padding: 0 10px;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 2px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 12px;
            opacity: 0.9;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº„Ç≥„É≥„Éà„É≠„Éº„É´ */
        .header-controls {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .theme-toggle:active {
            transform: scale(0.9);
        }

        /* „É¨„Éº„ÇπÈÅ∏Êäû„Ç®„É™„Ç¢ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .race-selector {
            background: white;
            margin: 10px 0;
            padding: 15px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .race-selector-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .race-selector-title::before {
            content: "üèá";
            font-size: 16px;
        }

        /* „É¨„Éº„Çπ„Ç∞„É´„Éº„Éó - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .race-groups {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .race-group {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .race-group-header {
            background: #f8f9fa;
            padding: 8px 12px;
            font-weight: 600;
            color: #495057;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
        }

        .race-group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 8px;
        }

        .race-tab-button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex: 0 0 auto;
        }

        .race-tab-button:active {
            transform: scale(0.95);
        }

        .race-tab-button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .content-area {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 15px;
        }

        /* „Çµ„Éñ„Çø„Éñ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .sub-tabs {
            background: #f8f9fa;
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .sub-tab-button {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .sub-tab-button.active {
            color: #2c3e50;
            background: white;
        }

        .sub-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        /* „Éï„Ç£„É´„Çø„Éº„Çª„ÇØ„Ç∑„Éß„É≥ */
        .filter-section {
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 150px;
        }

        .filter-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .filter-button {
            padding: 4px 10px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 12px;
            font-size: 11px;
            transition: all 0.2s ease;
        }

        .filter-button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .sort-select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            background: white;
            cursor: pointer;
            width: 100%;
        }

        /* „ÇØ„Ç§„ÉÉ„ÇØ„Éì„É•„Éº„Çª„ÇØ„Ç∑„Éß„É≥ */
        .quick-view-section {
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .quick-view-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .view-mode-buttons {
            display: flex;
            gap: 5px;
        }

        .view-mode-button {
            padding: 4px 8px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 4px;
            font-size: 11px;
        }

        .view-mode-button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        .quick-view-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 12px;
        }

        .quick-view-table th {
            background: #f8f9fa;
            padding: 6px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
        }

        .quick-view-table td {
            padding: 6px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }

        .quick-view-table .horse-name-cell {
            text-align: left;
            font-weight: 500;
        }

        /* ÊØîËºÉÊ©üËÉΩ */
        .comparison-section {
            display: none;
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-section.active {
            display: block;
        }

        .comparison-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .comparison-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .compare-button {
            padding: 6px 12px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            cursor: pointer;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .compare-button.active {
            background: #3498db;
            color: white;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            overflow-x: auto;
            display: block;
        }

        .comparison-table th {
            background: #f8f9fa;
            padding: 6px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            left: 0;
            z-index: 1;
        }

        .comparison-table td {
            padding: 6px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }

        .comparison-table .metric-name {
            background: #f8f9fa;
            position: sticky;
            left: 0;
            font-weight: 600;
            text-align: left;
        }

        /* „Éá„Éº„ÇøÂèØË¶ñÂåñ */
        .chart-section {
            padding: 15px;
            background: white;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin-bottom: 20px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 5px;
            padding: 10px 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 30px;
        }

        .bar {
            width: 25px;
            background: #3498db;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .bar-label {
            font-size: 10px;
            margin-top: 5px;
            color: #6c757d;
        }

        .bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: 600;
            color: #333;
        }

        /* Âç∞„ÅÆÂàÜÂ∏É */
        .mark-distribution {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .mark-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            min-width: 60px;
        }

        .mark-stat-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mark-stat-count {
            font-size: 14px;
            font-weight: 700;
            color: #333;
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Éª„Ç®„É©„Éº */
        .loading, .error {
            text-align: center;
            padding: 40px 20px;
            font-size: 14px;
        }

        .loading {
            color: #6c757d;
        }

        .loading::before {
            content: "‚è≥ ";
            font-size: 20px;
        }

        .error {
            background: #dc3545;
            color: white;
            border-radius: 6px;
            margin: 10px;
        }

        /* „Çµ„Éû„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .summary-section {
            padding: 15px 10px;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-title::before {
            content: "üìä";
            font-size: 18px;
        }

        /* È¶¨„Ç´„Éº„Éâ„Ç∞„É™„ÉÉ„Éâ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .summary-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* È¶¨„Ç´„Éº„Éâ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .summary-card {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
        }

        .summary-card:active {
            transform: scale(0.98);
        }

        .summary-card.selected-for-compare {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .compare-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            z-index: 10;
        }

        /* „Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„Éº - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .horse-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .horse-number {
            background: rgba(255,255,255,0.2);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .horse-name {
            font-size: 16px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            word-break: keep-all;
            overflow-wrap: break-word;
        }

        /* Âç∞„Éê„ÉÉ„Ç∏ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .mark-badge {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .mark-‚óé { background: #ff4757; color: white; }
        .mark-‚óã { background: #00d2d3; color: white; }
        .mark-‚ñ≤ { background: #54a0ff; color: white; }
        .mark-‚ñ≥ { background: #48dbfb; color: white; }
        .mark-‚òÜ { background: #feca57; color: #2c3e50; }
        .mark-‚≠êÔ∏é { background: #ff9ff3; color: white; }
        .mark-√ó { background: #ee5a6f; color: white; }
        .mark-Ê∂à { background: #a4b0be; color: white; }

        /* È¶¨ÊÉÖÂ†±Áµ±Ë®à - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .horse-stats {
            padding: 12px;
            display: grid;
            gap: 10px;
            grid-template-columns: 1fr;
        }

        .horse-stats.compact {
            display: none;
        }

        .stat-group {
            background: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .stat-group-title {
            font-size: 10px;
            font-weight: 700;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 3px 0;
            font-size: 12px;
        }

        .stat-label {
            color: #6c757d;
            flex: 1;
            min-width: 0;
            padding-right: 8px;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
            flex-shrink: 0;
            text-align: right;
        }

        /* ÁâπÂà•„Å™ÂÄ§„ÅÆ„Çπ„Çø„Ç§„É´ */
        .odds-value { color: #e74c3c; }
        .score-value {
            color: #3498db;
            font-size: 18px;
            font-weight: 700;
        }
        .popularity-value { color: #27ae60; }

        .track-aptitude-0 { color: #95a5a6; }
        .track-aptitude-1 { color: #3498db; }
        .track-aptitude-2 { color: #27ae60; font-weight: 600; }
        .track-aptitude-3 {
            color: #e74c3c;
            font-weight: 700;
        }

        /* HTML„Ç≥„É≥„ÉÜ„É≥„ÉÑÈÉ®ÂàÜ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .html-content {
            padding: 10px;
            border-top: 2px solid #e9ecef;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* „ÉÜ„Éº„Éñ„É´„ÅÆ„É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .html-content table {
            width: 100%;
            min-width: 500px;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-radius: 6px;
            overflow: hidden;
        }

        .html-content th {
            background: #2c3e50;
            color: white;
            padding: 6px 4px;
            text-align: center;
            font-weight: 600;
            font-size: 9px;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .html-content td {
            padding: 4px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            background: white;
            font-size: 9px;
            white-space: nowrap;
        }

        /* Êû†Áï™„ÅÆËâ≤ */
        .html-content .frame-1 { background: #fff; color: #000; border: 2px solid #000; }
        .html-content .frame-2 { background: #000; color: #fff; }
        .html-content .frame-3 { background: #f44336; color: #fff; }
        .html-content .frame-4 { background: #2196f3; color: #fff; }
        .html-content .frame-5 { background: #ffeb3b; color: #000; }
        .html-content .frame-6 { background: #4caf50; color: #fff; }
        .html-content .frame-7 { background: #ff9800; color: #fff; }
        .html-content .frame-8 { background: #e91e63; color: #fff; }

        /* „Çª„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éà„É´ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .html-content .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #2c3e50;
            margin: 20px 0 10px;
            padding-left: 10px;
            border-left: 3px solid #3498db;
        }

        /* „Éê„Ç§„Ç¢„ÇπÊÉÖÂ†±Á≠â„ÅÆ„Éú„ÉÉ„ÇØ„Çπ - „É¢„Éê„Ç§„É´ÊúÄÈÅ©Âåñ */
        .html-content .lower-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .html-content .bias-info,
        .html-content .score-info,
        .html-content .ranking {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        /* „Çπ„ÇØ„É≠„Éº„É´„Éà„ÉÉ„Éó„Éú„Çø„É≥ */
        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
            z-index: 90;
            transition: all 0.3s ease;
        }

        .scroll-to-top.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-to-top:active {
            transform: scale(0.9);
        }

        /* „Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩ„Ç®„É™„Ç¢„ÅÆË°®Á§∫ */
        .scroll-hint {
            display: none;
            text-align: center;
            font-size: 10px;
            color: #6c757d;
            padding: 5px;
            background: rgba(255,255,255,0.9);
            position: sticky;
            left: 0;
            margin-top: -5px;
        }

        .html-content::-webkit-scrollbar {
            height: 4px;
        }

        .html-content::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .html-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 2px;
        }

        /* „Çø„Éñ„É¨„ÉÉ„ÉàÂØæÂøú */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container {
                max-width: 768px;
                margin: 0 auto;
                padding: 0 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .summary-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .horse-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-controls {
                flex-direction: row;
            }

            .bar-chart {
                gap: 10px;
            }

            .bar {
                width: 35px;
            }
        }

        /* „Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÂØæÂøú */
        @media (min-width: 1025px) {
            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 20px;
            }

            .header {
                padding: 30px 0;
            }

            .header h1 {
                font-size: 28px;
                margin-bottom: 5px;
            }

            .header p {
                font-size: 14px;
            }

            .race-selector {
                padding: 20px;
                margin: 20px 0;
            }

            .race-selector-title {
                font-size: 16px;
                margin-bottom: 15px;
            }

            .race-groups {
                display: grid;
                gap: 15px;
            }

            .race-tab-button {
                padding: 8px 16px;
                font-size: 13px;
                border-radius: 20px;
            }

            .race-tab-button:hover {
                background: #3498db;
                color: white;
                border-color: #3498db;
                transform: scale(1.05);
            }

            .summary-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
                gap: 20px;
            }

            .summary-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.12);
                border-color: #3498db;
            }

            .horse-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .html-content {
                padding: 20px;
            }

            .html-content table {
                font-size: 12px;
            }

            .html-content th,
            .html-content td {
                padding: 8px;
            }

            .html-content .lower-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }

            .filter-controls {
                flex-direction: row;
            }

            .bar-chart {
                gap: 15px;
            }

            .bar {
                width: 40px;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .summary-card {
            animation: fadeIn 0.3s ease;
        }

        /* „É¢„Éê„Ç§„É´„Åß„ÅÆ„Çø„ÉÉ„ÉÅÊìç‰ΩúÊîπÂñÑ */
        @media (hover: none) and (pointer: coarse) {
            .race-tab-button,
            .sub-tab-button,
            .filter-button,
            .compare-button {
                -webkit-tap-highlight-color: rgba(52, 152, 219, 0.2);
            }
        }

        /* Ê®™„Çπ„ÇØ„É≠„Éº„É´„ÅÆ„Éí„É≥„ÉàË°®Á§∫ */
        @media (max-width: 767px) {
            .html-content {
                position: relative;
            }

            .html-content table {
                display: block;
            }

            .scroll-hint {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="header-content">
                <h1>Á´∂È¶¨Âá∫È¶¨Ë°®„Éì„É•„Éº„Ç¢„Éº</h1>
                <p>AI„Çπ„Ç≥„Ç¢ÂàÜÊûê & Ë©≥Á¥∞„Éá„Éº„Çø</p>
                <div class="header-controls">
                    <button class="theme-toggle" onclick="toggleTheme()" title="„ÉÜ„Éº„ÉûÂàáÊõø">
                        <span id="themeIcon">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="race-selector">
            <div class="race-selector-title">„É¨„Éº„ÇπÈÅ∏Êäû</div>
            <div class="race-groups" id="raceGroups">
                <div class="loading">„É¨„Éº„ÇπÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>
        </div>

        <div class="content-area" id="content">
            <div class="loading">„É¨„Éº„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
        </div>
    </div>

    <button class="scroll-to-top" onclick="scrollToTop()" title="„Éà„ÉÉ„Éó„Å∏Êàª„Çã">‚Üë</button>

    <script>
        // GitHub Pages„ÅÆË®≠ÂÆö
        const GITHUB_REPO = 'bakechhh/racetest'; // „Åì„Åì„ÇíÂÆüÈöõ„ÅÆ„É™„Éù„Ç∏„Éà„É™„Å´Â§âÊõ¥
        const GITHUB_BRANCH = 'main'; // „Åæ„Åü„ÅØ 'master'
        const BASE_URL = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}`;

        // „Éá„Éº„Çø„ÇíÊ†ºÁ¥ç
        let racesData = {};
        let currentRace = null;
        let currentSubTab = 'ability'; // 'ability' or 'value'
        let currentFilters = {
            marks: [],
            sortBy: 'default'
        };
        let selectedForCompare = [];
        let isComparisonMode = false;
        let quickViewMode = 'ability';

        // Âç∞„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
        const markPriority = {
            '‚óé': 1,
            '‚óã': 2,
            '‚ñ≤': 3,
            '‚ñ≥': 4,
            '‚òÜ': 5,
            '‚≠êÔ∏é': 6,
            '√ó': 7,
            '√ó√ó': 8,
            'Ê∂à': 9
        };

        // ÂàùÊúüÂåñ
        async function init() {
            try {
                // JSON„Éï„Ç°„Ç§„É´„ÅÆ„É™„Çπ„Éà„ÇíÂèñÂæóÔºàGitHub API„Çí‰ΩøÁî®Ôºâ
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/json?ref=${GITHUB_BRANCH}`);
                if (!response.ok) throw new Error('JSON„Éï„Ç°„Ç§„É´„É™„Çπ„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');

                const files = await response.json();
                const jsonFiles = files.filter(file => file.name.endsWith('.json'));

                // ÂêÑJSON„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
                for (const file of jsonFiles) {
                    const raceName = file.name.replace('.json', '');
                    const jsonResponse = await fetch(`${BASE_URL}/json/${file.name}`);
                    if (jsonResponse.ok) {
                        const jsonData = await jsonResponse.json();
                        racesData[raceName] = jsonData;
                    }
                }

                // „É¨„Éº„Çπ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
                createRaceGroups();

                // „ÉÜ„Éº„Éû„ÇíÂæ©ÂÖÉ
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
                }

            } catch (error) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                document.getElementById('raceGroups').innerHTML =
                    '<div class="error">„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„É™„Éù„Ç∏„Éà„É™Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</div>';
            }
        }

        // „É¨„Éº„ÇπÂêç„Åã„ÇâÂ†¥ÊâÄ„Å®Áï™Âè∑„ÇíÊäΩÂá∫
        function parseRaceName(raceName) {
            const match = raceName.match(/^(.+?)(\d+)R$/);
            if (match) {
                return {
                    place: match[1],
                    number: parseInt(match[2])
                };
            }
            return null;
        }

        // „É¨„Éº„Çπ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
        function createRaceGroups() {
            const groupsContainer = document.getElementById('raceGroups');
            groupsContainer.innerHTML = '';

            // „É¨„Éº„Çπ„ÇíÂ†¥ÊâÄ„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const racesByPlace = {};
            Object.keys(racesData).forEach(raceName => {
                const parsed = parseRaceName(raceName);
                if (parsed) {
                    if (!racesByPlace[parsed.place]) {
                        racesByPlace[parsed.place] = [];
                    }
                    racesByPlace[parsed.place].push({
                        name: raceName,
                        number: parsed.number
                    });
                }
            });

            // Â†¥ÊâÄ„Çí„ÇΩ„Éº„Éà
            const places = Object.keys(racesByPlace).sort();

            if (places.length === 0) {
                groupsContainer.innerHTML = '<div class="error">„É¨„Éº„Çπ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            // ÂêÑÂ†¥ÊâÄ„ÅÆ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
            places.forEach((place, placeIndex) => {
                const group = document.createElement('div');
                group.className = 'race-group';

                const header = document.createElement('div');
                header.className = 'race-group-header';
                header.textContent = place;

                const items = document.createElement('div');
                items.className = 'race-group-items';

                // „É¨„Éº„ÇπÁï™Âè∑„Åß„ÇΩ„Éº„Éà
                const races = racesByPlace[place].sort((a, b) => a.number - b.number);

                races.forEach((race, index) => {
                    const button = document.createElement('button');
                    button.className = 'race-tab-button';
                    button.textContent = race.name;
                    button.onclick = () => selectRace(race.name);

                    // ÊúÄÂàù„ÅÆÂ†¥ÊâÄ„ÅÆÊúÄÂàù„ÅÆ„É¨„Éº„Çπ„ÇíÈÅ∏Êäû
                    if (placeIndex === 0 && index === 0) {
                        button.classList.add('active');
                        selectRace(race.name);
                    }

                    items.appendChild(button);
                });

                group.appendChild(header);
                group.appendChild(items);
                groupsContainer.appendChild(group);
            });
        }

        // „É¨„Éº„Çπ„ÇíÈÅ∏Êäû
        async function selectRace(raceName) {
            currentRace = raceName;
            currentFilters = { marks: [], sortBy: 'default' };
            selectedForCompare = [];
            isComparisonMode = false;

            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„Éñ„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.race-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === raceName) {
                    btn.classList.add('active');
                }
            });

            await displayRaceContent();
        }

        // „É¨„Éº„Çπ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
        async function displayRaceContent() {
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = '<div class="loading">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>';

            try {
                // „Çµ„Éñ„Çø„Éñ„Çí‰ΩúÊàê
                const subTabsHtml = `
                    <div class="sub-tabs">
                        <button class="sub-tab-button ${currentSubTab === 'ability' ? 'active' : ''}"
                                onclick="switchSubTab('ability')">ËÉΩÂäõÈ†Ü</button>
                        <button class="sub-tab-button ${currentSubTab === 'value' ? 'active' : ''}"
                                onclick="switchSubTab('value')">ÊúüÂæÖÂÄ§È†Ü</button>
                    </div>
                `;

                // JSON„Éá„Éº„Çø„ÇíÂèñÂæó
                const jsonData = racesData[currentRace];

                // „Éï„Ç£„É´„Çø„Éº„Çª„ÇØ„Ç∑„Éß„É≥
                const filterHtml = createFilterSection(jsonData);

                // „ÇØ„Ç§„ÉÉ„ÇØ„Éì„É•„Éº„Çª„ÇØ„Ç∑„Éß„É≥
                const quickViewHtml = createQuickViewSection(jsonData);

                // ÊØîËºÉ„Çª„ÇØ„Ç∑„Éß„É≥
                const comparisonHtml = createComparisonSection();

                // „Éá„Éº„ÇøÂèØË¶ñÂåñ„Çª„ÇØ„Ç∑„Éß„É≥
                const chartHtml = createChartSection(jsonData);

                // „Çµ„Éû„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥
                const summaryHtml = createSummary(jsonData, currentSubTab);

                // HTML„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
                const htmlResponse = await fetch(`${BASE_URL}/html/${currentRace}.html`);
                let htmlContent = '';

                if (htmlResponse.ok) {
                    htmlContent = await htmlResponse.text();
                    // HTML„ÅÆbody„Çø„Ç∞ÂÜÖ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊäΩÂá∫
                    const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*)<\/body>/i);
                    if (bodyMatch) {
                        htmlContent = bodyMatch[1];
                    }
                }

                // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
                contentArea.innerHTML = subTabsHtml + filterHtml + quickViewHtml + 
                    comparisonHtml + chartHtml + summaryHtml + 
                    '<div class="html-content">' + 
                    '<div class="scroll-hint">‚Üê Ê®™„Çπ„ÇØ„É≠„Éº„É´„ÅßÂÖ®‰Ωì„ÇíË°®Á§∫ ‚Üí</div>' +
                    htmlContent + '</div>';

            } catch (error) {
                console.error('„É¨„Éº„ÇπÊÉÖÂ†±„ÅÆË°®Á§∫„Ç®„É©„Éº:', error);
                contentArea.innerHTML = '<div class="error">„É¨„Éº„ÇπÊÉÖÂ†±„ÅÆË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>';
            }
        }

        // „Éï„Ç£„É´„Çø„Éº„Çª„ÇØ„Ç∑„Éß„É≥„Çí‰ΩúÊàê
        function createFilterSection(jsonData) {
            const marks = ['‚óé', '‚óã', '‚ñ≤', '‚ñ≥', '‚òÜ', '‚≠êÔ∏é', '√ó', 'Ê∂à'];
            
            return `
                <div class="filter-section">
                    <div class="filter-title">„Éï„Ç£„É´„Çø„Éº & „ÇΩ„Éº„Éà</div>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <div class="filter-label">Âç∞„Åß„Éï„Ç£„É´„Çø„Éº</div>
                            <div class="filter-buttons">
                                ${marks.map(mark => `
                                    <button class="filter-button mark-filter" data-mark="${mark}"
                                            onclick="toggleMarkFilter('${mark}')">
                                        ${mark}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div class="filter-group">
                            <div class="filter-label">‰∏¶„Å≥È†Ü</div>
                            <select class="sort-select" onchange="changeSortOrder(this.value)">
                                <option value="default">„Éá„Éï„Ç©„É´„Éà</option>
                                <option value="popularity">‰∫∫Ê∞óÈ†Ü</option>
                                <option value="odds">„Ç™„ÉÉ„Ç∫È†Ü</option>
                                <option value="score">„Çπ„Ç≥„Ç¢È†Ü</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="compare-button" onclick="toggleComparisonMode()">
                            ÊØîËºÉ„É¢„Éº„Éâ
                        </button>
                        <button class="filter-button" onclick="resetFilters()">
                            „Éï„Ç£„É´„Çø„Éº„Çí„É™„Çª„ÉÉ„Éà
                        </button>
                    </div>
                </div>
            `;
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Éì„É•„Éº„Çª„ÇØ„Ç∑„Éß„É≥„Çí‰ΩúÊàê
        function createQuickViewSection(jsonData) {
            return `
                <div class="quick-view-section">
                    <div class="quick-view-title">
                        <span>„ÇØ„Ç§„ÉÉ„ÇØ„Éì„É•„Éº</span>
                        <div class="view-mode-buttons">
                            <button class="view-mode-button ${quickViewMode === 'ability' ? 'active' : ''}"
                                    onclick="changeQuickViewMode('ability')">ËÉΩÂäõ</button>
                            <button class="view-mode-button ${quickViewMode === 'value' ? 'active' : ''}"
                                    onclick="changeQuickViewMode('value')">ÊúüÂæÖÂÄ§</button>
                        </div>
                    </div>
                    <div id="quickViewContent">
                        ${createQuickViewTable(jsonData, quickViewMode)}
                    </div>
                </div>
            `;
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Éì„É•„Éº„ÉÜ„Éº„Éñ„É´„Çí‰ΩúÊàê
        function createQuickViewTable(jsonData, mode) {
            if (!jsonData || !jsonData.horses) return '';

            const horses = getFilteredAndSortedHorses(jsonData.horses);
            const markField = mode === 'ability' ? 'mark' : 'investment_mark';

            let html = `
                <table class="quick-view-table">
                    <thead>
                        <tr>
                            <th>Âç∞</th>
                            <th>Áï™</th>
                            <th>È¶¨Âêç</th>
                            <th>‰∫∫Ê∞ó</th>
                            <th>„Ç™„ÉÉ„Ç∫</th>
                            <th>„Çπ„Ç≥„Ç¢</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            horses.forEach(horse => {
                const mark = horse[markField];
                html += `
                    <tr>
                        <td>${mark ? `<span class="mark-badge mark-${mark}" style="width: 25px; height: 25px; font-size: 12px;">${mark}</span>` : '-'}</td>
                        <td>${horse.horse_number}</td>
                        <td class="horse-name-cell">${horse.name}</td>
                        <td>${horse.popularity}Áï™</td>
                        <td>${horse.odds}ÂÄç</td>
                        <td>${horse.score.toFixed(2)}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            return html;
        }

        // ÊØîËºÉ„Çª„ÇØ„Ç∑„Éß„É≥„Çí‰ΩúÊàê
        function createComparisonSection() {
            return `
                <div class="comparison-section" id="comparisonSection">
                    <div class="comparison-title">È¶¨„ÅÆÊØîËºÉ</div>
                    <div id="comparisonContent">
                        <p style="color: #6c757d; font-size: 12px;">ÊØîËºÉ„Åó„Åü„ÅÑÈ¶¨„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÊúÄÂ§ß3È†≠Ôºâ</p>
                    </div>
                </div>
            `;
        }

        // „ÉÅ„É£„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥„Çí‰ΩúÊàê
        function createChartSection(jsonData) {
            if (!jsonData || !jsonData.horses) return '';

            // Âç∞„ÅÆÂàÜÂ∏É„ÇíË®àÁÆó
            const markCounts = {};
            const marks = ['‚óé', '‚óã', '‚ñ≤', '‚ñ≥', '‚òÜ', '‚≠êÔ∏é', '√ó', 'Ê∂à'];
            marks.forEach(mark => markCounts[mark] = 0);

            jsonData.horses.forEach(horse => {
                const mark = currentSubTab === 'ability' ? horse.mark : horse.investment_mark;
                if (mark && markCounts.hasOwnProperty(mark)) {
                    markCounts[mark]++;
                }
            });

            return `
                <div class="chart-section">
                    <div class="chart-title">„Éá„Éº„ÇøÂèØË¶ñÂåñ</div>
                    
                    <div style="margin-bottom: 20px;">
                        <div class="chart-title" style="font-size: 13px;">Âç∞„ÅÆÂàÜÂ∏É</div>
                        <div class="mark-distribution">
                            ${marks.map(mark => `
                                <div class="mark-stat">
                                    <div class="mark-stat-icon mark-${mark}">${mark}</div>
                                    <div class="mark-stat-count">${markCounts[mark]}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div>
                        <div class="chart-title" style="font-size: 13px;">„Çπ„Ç≥„Ç¢ÂàÜÂ∏É</div>
                        <div class="chart-container">
                            <div class="bar-chart" id="scoreChart">
                                ${createScoreChart(jsonData)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // „Çπ„Ç≥„Ç¢„ÉÅ„É£„Éº„Éà„Çí‰ΩúÊàê
        function createScoreChart(jsonData) {
            const horses = getFilteredAndSortedHorses(jsonData.horses);
            const maxScore = Math.max(...horses.map(h => h.score));

            return horses.map(horse => {
                const height = (horse.score / maxScore) * 100;
                return `
                    <div class="bar-item">
                        <div class="bar" style="height: ${height}%; background: ${getScoreColor(horse.score, maxScore)};">
                            <span class="bar-value">${horse.score.toFixed(0)}</span>
                        </div>
                        <span class="bar-label">${horse.horse_number}</span>
                    </div>
                `;
            }).join('');
        }

        // „Çπ„Ç≥„Ç¢„Å´Âü∫„Å•„ÅÑ„Å¶Ëâ≤„ÇíÂèñÂæó
        function getScoreColor(score, maxScore) {
            const ratio = score / maxScore;
            if (ratio > 0.8) return '#e74c3c';
            if (ratio > 0.6) return '#f39c12';
            if (ratio > 0.4) return '#3498db';
            return '#95a5a6';
        }

        // „Çµ„Éñ„Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà
        function switchSubTab(tab) {
            currentSubTab = tab;
            quickViewMode = tab;
            displayRaceContent();
        }

        // „Éà„É©„ÉÉ„ÇØÈÅ©ÊÄß„ÅÆË°®Á§∫„ÉÜ„Ç≠„Çπ„Éà
        function getTrackAptitudeText(value) {
            const texts = ['‰Ωé', 'ÊôÆÈÄö', 'È´ò', 'ÊúÄÈ´ò'];
            return texts[value] || '-';
        }

        // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®„Å®„ÇΩ„Éº„Éà
        function getFilteredAndSortedHorses(horses) {
            let filtered = [...horses];

            // Âç∞„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            if (currentFilters.marks.length > 0) {
                const markField = currentSubTab === 'ability' ? 'mark' : 'investment_mark';
                filtered = filtered.filter(horse => 
                    currentFilters.marks.includes(horse[markField])
                );
            }

            // „ÇΩ„Éº„Éà
            switch (currentFilters.sortBy) {
                case 'popularity':
                    filtered.sort((a, b) => a.popularity - b.popularity);
                    break;
                case 'odds':
                    filtered.sort((a, b) => a.odds - b.odds);
                    break;
                case 'score':
                    filtered.sort((a, b) => b.score - a.score);
                    break;
                default:
                    // „Éá„Éï„Ç©„É´„Éà„ÅØÂç∞„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
                    filtered.sort((a, b) => {
                        const markField = currentSubTab === 'ability' ? 'mark' : 'investment_mark';
                        const aPriority = markPriority[a[markField]] || 999;
                        const bPriority = markPriority[b[markField]] || 999;
                        if (aPriority !== bPriority) {
                            return aPriority - bPriority;
                        }
                        return b.score - a.score;
                    });
            }

            return filtered;
        }

        // „Çµ„Éû„É™„Éº„Çí‰ΩúÊàê
        function createSummary(jsonData, sortType) {
            if (!jsonData || !jsonData.horses) return '';

            const horses = getFilteredAndSortedHorses(jsonData.horses);

            let html = `
                <div class="summary-section">
                    <div class="summary-title">
                        ${sortType === 'ability' ? 'ËÉΩÂäõÈ†Ü' : 'ÊúüÂæÖÂÄ§È†Ü'}ÂàÜÊûê
                    </div>
                    <div class="summary-grid">
            `;

            horses.forEach((horse, index) => {
                const markField = sortType === 'ability' ? 'mark' : 'investment_mark';
                const mark = horse[markField];

                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÅÖÂª∂„ÇíË®≠ÂÆö
                const delay = index * 0.05;

                html += `
                    <div class="summary-card ${selectedForCompare.includes(horse.horse_number) ? 'selected-for-compare' : ''}" 
                         style="animation-delay: ${delay}s"
                         data-horse-number="${horse.horse_number}">
                        ${isComparisonMode ? `<input type="checkbox" class="compare-checkbox" 
                            ${selectedForCompare.includes(horse.horse_number) ? 'checked' : ''}
                            onclick="event.stopPropagation(); toggleCompareSelection(${horse.horse_number})">` : ''}
                        <div class="card-header" onclick="handleCardClick(${horse.horse_number})">
                            <div class="horse-info">
                                <div class="horse-number">${horse.horse_number}</div>
                                <div class="horse-name">${horse.name}</div>
                            </div>
                            ${mark ? `<div class="mark-badge mark-${mark}">${mark}</div>` : ''}
                        </div>

                        <div class="horse-stats">
                            <div class="stat-group">
                                <div class="stat-group-title">Âü∫Êú¨ÊÉÖÂ†±</div>
                                <div class="stat-item">
                                    <span class="stat-label">‰∫∫Ê∞ó</span>
                                    <span class="stat-value popularity-value">${horse.popularity}Áï™‰∫∫Ê∞ó</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">„Ç™„ÉÉ„Ç∫</span>
                                    <span class="stat-value odds-value">${horse.odds || '-'}ÂÄç</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">„Çπ„Ç≥„Ç¢</div>
                                <div class="stat-item">
                                    <span class="stat-label">Á∑èÂêà„Çπ„Ç≥„Ç¢</span>
                                    <span class="stat-value score-value">${horse.score ? horse.score.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Á∑èÂêà„Éù„Ç§„É≥„Éà</span>
                                    <span class="stat-value">${horse.total_points ? horse.total_points.toFixed(2) : '-'}</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</div>
                                <div class="stat-item">
                                    <span class="stat-label">‰∏ä„Çä3FÂπ≥Âùá</span>
                                    <span class="stat-value">${horse['‰∏ä„Çä3FÂπ≥Âùá'] || '-'}Áßí</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Ave-3FÂπ≥Âùá</span>
                                    <span class="stat-value">${horse['Ave-3FÂπ≥Âùá'] || '-'}Áßí</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">PCIÂπ≥Âùá</span>
                                    <span class="stat-value">${horse['PCIÂπ≥Âùá'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">3FÂú∞ÁÇπÂ∑Æ</span>
                                    <span class="stat-value">${horse['-3FÂ∑ÆÂπ≥Âùá'] || '-'}Áßí</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">ÈÅ©ÊÄß„ÉªÊäïË≥á‰æ°ÂÄ§</div>
                                <div class="stat-item">
                                    <span class="stat-label">ÊÉ≥ÂÆöËÑöË≥™</span>
                                    <span class="stat-value">${horse['ÊÉ≥ÂÆöËÑöË≥™'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">„Éà„É©„ÉÉ„ÇØÈÅ©ÊÄß</span>
                                    <span class="stat-value track-aptitude-${horse.track_aptitude}">
                                        ${getTrackAptitudeText(horse.track_aptitude)}
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Âπ≥ÂùáÁùÄÂ∑Æ</span>
                                    <span class="stat-value">${horse.avg_margin != null ? horse.avg_margin.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">„Éê„Ç§„Ç¢„ÇπÈÅ©ÊÄß</span>
                                    <span class="stat-value">${horse.track_bias_aptitude_score != null ? horse.track_bias_aptitude_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ÊäïË≥á‰æ°ÂÄ§</span>
                                    <span class="stat-value">${horse.investment_value_score != null ? horse.investment_value_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ÊäïË≥áË©ï‰æ°</span>
                                    <span class="stat-value">${horse.investment_rating != null ? horse.investment_rating.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ÂÆâÂÆöÊÄß</span>
                                    <span class="stat-value">${horse.stability_score || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // Âç∞„Éï„Ç£„É´„Çø„Éº„ÅÆ„Éà„Ç∞„É´
        function toggleMarkFilter(mark) {
            const index = currentFilters.marks.indexOf(mark);
            if (index > -1) {
                currentFilters.marks.splice(index, 1);
            } else {
                currentFilters.marks.push(mark);
            }
            
            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.mark-filter').forEach(btn => {
                if (btn.dataset.mark === mark) {
                    btn.classList.toggle('active');
                }
            });

            displayRaceContent();
        }

        // „ÇΩ„Éº„ÉàÈ†Ü„ÅÆÂ§âÊõ¥
        function changeSortOrder(sortBy) {
            currentFilters.sortBy = sortBy;
            displayRaceContent();
        }

        // „Éï„Ç£„É´„Çø„Éº„ÅÆ„É™„Çª„ÉÉ„Éà
        function resetFilters() {
            currentFilters = { marks: [], sortBy: 'default' };
            displayRaceContent();
        }

        // ÊØîËºÉ„É¢„Éº„Éâ„ÅÆ„Éà„Ç∞„É´
        function toggleComparisonMode() {
            isComparisonMode = !isComparisonMode;
            
            const btn = event.target;
            btn.classList.toggle('active');
            
            const compSection = document.getElementById('comparisonSection');
            if (isComparisonMode) {
                compSection.classList.add('active');
                // ÊØîËºÉ„É¢„Éº„Éâ„Å´ÂÖ•„Å£„Åü„ÇâÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
                selectedForCompare = [];
                updateComparisonDisplay();
            } else {
                compSection.classList.remove('active');
                selectedForCompare = [];
            }
            
            // „Éö„Éº„Ç∏„ÇíÂÜçÊèèÁîª
            displayRaceContent();
        }

        // „Ç´„Éº„Éâ„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº
        function handleCardClick(horseNumber) {
            if (isComparisonMode) {
                toggleCompareSelection(horseNumber);
            }
        }

        // ÊØîËºÉÈÅ∏Êäû„ÅÆ„Éà„Ç∞„É´
        function toggleCompareSelection(horseNumber) {
            const index = selectedForCompare.indexOf(horseNumber);
            if (index > -1) {
                selectedForCompare.splice(index, 1);
            } else if (selectedForCompare.length < 3) {
                selectedForCompare.push(horseNumber);
            } else {
                alert('ÊØîËºÉ„ÅØÊúÄÂ§ß3È†≠„Åæ„Åß„Åß„Åô');
                return;
            }
            
            // „Åô„Åê„Å´ÊØîËºÉË°®Á§∫„ÇíÊõ¥Êñ∞
            updateComparisonDisplay();
            
            // „Ç´„Éº„Éâ„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.summary-card').forEach(card => {
                const cardNumber = parseInt(card.querySelector('.horse-number').textContent);
                if (selectedForCompare.includes(cardNumber)) {
                    card.classList.add('selected-for-compare');
                } else {
                    card.classList.remove('selected-for-compare');
                }
            });
            
            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.compare-checkbox').forEach(checkbox => {
                const cardNumber = parseInt(checkbox.closest('.summary-card').querySelector('.horse-number').textContent);
                checkbox.checked = selectedForCompare.includes(cardNumber);
            });
        }

        // ÊØîËºÉË°®Á§∫„ÅÆÊõ¥Êñ∞
        function updateComparisonDisplay() {
            const compContent = document.getElementById('comparisonContent');
            if (!compContent) return;

            if (selectedForCompare.length === 0) {
                compContent.innerHTML = '<p style="color: #6c757d; font-size: 12px;">ÊØîËºÉ„Åó„Åü„ÅÑÈ¶¨„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÊúÄÂ§ß3È†≠Ôºâ</p>';
                return;
            }

            const jsonData = racesData[currentRace];
            const selectedHorses = jsonData.horses.filter(h => selectedForCompare.includes(h.horse_number));

            let html = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>È†ÖÁõÆ</th>
                            ${selectedHorses.map(h => `<th>${h.horse_number}Áï™<br>${h.name}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="metric-name">‰∫∫Ê∞ó</td>
                            ${selectedHorses.map(h => `<td>${h.popularity}Áï™‰∫∫Ê∞ó</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">„Ç™„ÉÉ„Ç∫</td>
                            ${selectedHorses.map(h => `<td>${h.odds}ÂÄç</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">Á∑èÂêà„Çπ„Ç≥„Ç¢</td>
                            ${selectedHorses.map(h => `<td style="font-weight: 700; color: #3498db;">${h.score.toFixed(2)}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">‰∏ä„Çä3FÂπ≥Âùá</td>
                            ${selectedHorses.map(h => `<td>${h['‰∏ä„Çä3FÂπ≥Âùá'] || '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">PCIÂπ≥Âùá</td>
                            ${selectedHorses.map(h => `<td>${h['PCIÂπ≥Âùá'] || '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ÊÉ≥ÂÆöËÑöË≥™</td>
                            ${selectedHorses.map(h => `<td>${h['ÊÉ≥ÂÆöËÑöË≥™'] || '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">„Éà„É©„ÉÉ„ÇØÈÅ©ÊÄß</td>
                            ${selectedHorses.map(h => `<td>${getTrackAptitudeText(h.track_aptitude)}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">„Éê„Ç§„Ç¢„ÇπÈÅ©ÊÄß</td>
                            ${selectedHorses.map(h => `<td>${h.track_bias_aptitude_score != null ? h.track_bias_aptitude_score.toFixed(1) : '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ÊäïË≥á‰æ°ÂÄ§</td>
                            ${selectedHorses.map(h => `<td>${h.investment_value_score != null ? h.investment_value_score.toFixed(1) : '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ÂÆâÂÆöÊÄß</td>
                            ${selectedHorses.map(h => `<td>${h.stability_score || '-'}</td>`).join('')}
                        </tr>
                    </tbody>
                </table>
            `;

            compContent.innerHTML = html;
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„Éì„É•„Éº„É¢„Éº„Éâ„ÅÆÂ§âÊõ¥
        function changeQuickViewMode(mode) {
            quickViewMode = mode;
            const jsonData = racesData[currentRace];
            document.getElementById('quickViewContent').innerHTML = createQuickViewTable(jsonData, mode);
            
            document.querySelectorAll('.view-mode-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === (mode === 'ability' ? 'ËÉΩÂäõ' : 'ÊúüÂæÖÂÄ§')) {
                    btn.classList.add('active');
                }
            });
        }

        // „ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // „Éà„ÉÉ„Éó„Å∏„Çπ„ÇØ„É≠„Éº„É´
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // „Çπ„ÇØ„É≠„Éº„É´Áõ£Ë¶ñ
        window.addEventListener('scroll', () => {
            const scrollButton = document.querySelector('.scroll-to-top');
            if (window.pageYOffset > 300) {
                scrollButton.classList.add('visible');
            } else {
                scrollButton.classList.remove('visible');
            }
        });

        // „Ç∞„É≠„Éº„Éê„É´„Å´Èñ¢Êï∞„ÇíÂÖ¨Èñã
        window.switchSubTab = switchSubTab;
        window.toggleMarkFilter = toggleMarkFilter;
        window.changeSortOrder = changeSortOrder;
        window.resetFilters = resetFilters;
        window.toggleComparisonMode = toggleComparisonMode;
        window.handleCardClick = handleCardClick;
        window.toggleCompareSelection = toggleCompareSelection;
        window.changeQuickViewMode = changeQuickViewMode;
        window.toggleTheme = toggleTheme;
        window.scrollToTop = scrollToTop;

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', init);

        // „Éì„É•„Éº„Éù„Éº„Éà„ÅÆÈ´ò„Åï„ÇíË®≠ÂÆöÔºà„É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂ÂØæÂøúÔºâ
        function setViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        setViewportHeight();
        window.addEventListener('resize', setViewportHeight);
    </script>
</body>
</html>
