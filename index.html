<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á´∂È¶¨Âá∫È¶¨Ë°®„Éì„É•„Éº„Ç¢„Éº</title>
    <style>
        /* „É™„Çª„ÉÉ„Éà„Å®„Éô„Éº„ÇπË®≠ÂÆö */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            background-color: #f0f2f5;
            color: #1a1a1a;
            line-height: 1.6;
        }

        /* „Ç≥„É≥„ÉÜ„Éä */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* „É¨„Éº„ÇπÈÅ∏Êäû„Ç®„É™„Ç¢ */
        .race-selector {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .race-selector-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .race-selector-title::before {
            content: "üèá";
            font-size: 20px;
        }

        /* „É¨„Éº„Çπ„Ç∞„É´„Éº„Éó */
        .race-groups {
            display: grid;
            gap: 15px;
        }

        .race-group {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .race-group:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .race-group-header {
            background: #f8f9fa;
            padding: 10px 15px;
            font-weight: 600;
            color: #495057;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        .race-group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
        }

        .race-tab-button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .race-tab-button:hover {
            background: #3498db;
            color: white;
            border-color: #3498db;
            transform: scale(1.05);
        }

        .race-tab-button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
            box-shadow: 0 2px 6px rgba(44, 62, 80, 0.3);
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ */
        .content-area {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* „Çµ„Éñ„Çø„Éñ */
        .sub-tabs {
            background: #f8f9fa;
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .sub-tab-button {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .sub-tab-button:hover {
            color: #3498db;
            background: rgba(52, 152, 219, 0.05);
        }

        .sub-tab-button.active {
            color: #2c3e50;
            background: white;
        }

        .sub-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Éª„Ç®„É©„Éº */
        .loading, .error {
            text-align: center;
            padding: 60px 20px;
        }

        .loading {
            color: #6c757d;
        }

        .loading::before {
            content: "‚è≥ ";
            font-size: 24px;
        }

        .error {
            background: #dc3545;
            color: white;
            border-radius: 8px;
            margin: 20px;
        }

        /* „Çµ„Éû„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥ */
        .summary-section {
            padding: 20px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-title::before {
            content: "üìä";
            font-size: 20px;
        }

        /* È¶¨„Ç´„Éº„Éâ„Ç∞„É™„ÉÉ„Éâ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        /* È¶¨„Ç´„Éº„Éâ */
        .summary-card {
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border-color: #3498db;
        }

        /* „Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„Éº */
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .horse-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .horse-number {
            background: rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .horse-name {
            font-size: 18px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        /* Âç∞„Éê„ÉÉ„Ç∏ */
        .mark-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .mark-‚óé { background: #ff4757; color: white; }
        .mark-‚óã { background: #00d2d3; color: white; }
        .mark-‚ñ≤ { background: #54a0ff; color: white; }
        .mark-‚ñ≥ { background: #48dbfb; color: white; }
        .mark-‚òÜ { background: #feca57; color: #2c3e50; }
        .mark-‚≠êÔ∏é { background: #ff9ff3; color: white; }
        .mark-√ó { background: #ee5a6f; color: white; }
        .mark-Ê∂à { background: #a4b0be; color: white; }

        /* È¶¨ÊÉÖÂ†±Áµ±Ë®à */
        .horse-stats {
            padding: 15px;
            display: grid;
            gap: 12px;
        }

        .stat-group {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .stat-group-title {
            font-size: 11px;
            font-weight: 700;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 13px;
        }

        .stat-label {
            color: #6c757d;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
        }

        /* ÁâπÂà•„Å™ÂÄ§„ÅÆ„Çπ„Çø„Ç§„É´ */
        .odds-value { color: #e74c3c; }
        .score-value {
            color: #3498db;
            font-size: 20px;
            font-weight: 700;
        }
        .popularity-value { color: #27ae60; }

        .track-aptitude-0 { color: #95a5a6; }
        .track-aptitude-1 { color: #3498db; }
        .track-aptitude-2 { color: #27ae60; font-weight: 600; }
        .track-aptitude-3 {
            color: #e74c3c;
            font-weight: 700;
            text-shadow: 0 0 3px rgba(231, 76, 60, 0.3);
        }

        /* HTML„Ç≥„É≥„ÉÜ„É≥„ÉÑÈÉ®ÂàÜ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .html-content {
            padding: 20px;
            border-top: 2px solid #e9ecef;
        }

        /* Êó¢Â≠ò„ÅÆHTMLÂÜÖ„ÅÆ„ÉÜ„Éº„Éñ„É´„Çπ„Çø„Ç§„É´ÊîπÂñÑ */
        .html-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .html-content th {
            background: #2c3e50;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .html-content td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            background: white;
        }

        .html-content tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .html-content tr:hover td {
            background: #e3f2fd;
        }

        /* Êû†Áï™„ÅÆËâ≤ */
        .html-content .frame-1 { background: #fff; color: #000; border: 2px solid #000; }
        .html-content .frame-2 { background: #000; color: #fff; }
        .html-content .frame-3 { background: #f44336; color: #fff; }
        .html-content .frame-4 { background: #2196f3; color: #fff; }
        .html-content .frame-5 { background: #ffeb3b; color: #000; }
        .html-content .frame-6 { background: #4caf50; color: #fff; }
        .html-content .frame-7 { background: #ff9800; color: #fff; }
        .html-content .frame-8 { background: #e91e63; color: #fff; }

        /* „Çª„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éà„É´ */
        .html-content .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin: 30px 0 15px;
            padding-left: 15px;
            border-left: 4px solid #3498db;
        }

        /* „Éê„Ç§„Ç¢„ÇπÊÉÖÂ†±Á≠â„ÅÆ„Éú„ÉÉ„ÇØ„Çπ */
        .html-content .lower-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .html-content .bias-info,
        .html-content .score-info,
        .html-content .ranking {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }

            .race-group-items {
                gap: 5px;
            }

            .race-tab-button {
                padding: 6px 12px;
                font-size: 12px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .horse-stats {
                grid-template-columns: 1fr;
            }

            .html-content {
                padding: 10px;
                overflow-x: auto;
            }

            .html-content table {
                font-size: 10px;
                min-width: 600px;
            }

            .html-content th,
            .html-content td {
                padding: 5px;
            }

            .html-content .lower-container {
                grid-template-columns: 1fr;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .summary-card {
            animation: fadeIn 0.3s ease;
        }

        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÅÆ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="header-content">
                <h1>Á´∂È¶¨Âá∫È¶¨Ë°®„Éì„É•„Éº„Ç¢„Éº</h1>
                <p>AI„Çπ„Ç≥„Ç¢ÂàÜÊûê & Ë©≥Á¥∞„Éá„Éº„Çø</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="race-selector">
            <div class="race-selector-title">„É¨„Éº„ÇπÈÅ∏Êäû</div>
            <div class="race-groups" id="raceGroups">
                <div class="loading">„É¨„Éº„ÇπÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>
        </div>

        <div class="content-area" id="content">
            <div class="loading">„É¨„Éº„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
        </div>
    </div>

    <script>
        // GitHub Pages„ÅÆË®≠ÂÆö
        const GITHUB_REPO = 'bakechhh/racetest'; // „Åì„Åì„ÇíÂÆüÈöõ„ÅÆ„É™„Éù„Ç∏„Éà„É™„Å´Â§âÊõ¥
        const GITHUB_BRANCH = 'main'; // „Åæ„Åü„ÅØ 'master'
        const BASE_URL = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}`;

        // „Éá„Éº„Çø„ÇíÊ†ºÁ¥ç
        let racesData = {};
        let currentRace = null;
        let currentSubTab = 'ability'; // 'ability' or 'value'

        // Âç∞„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
        const markPriority = {
            '‚óé': 1,
            '‚óã': 2,
            '‚ñ≤': 3,
            '‚ñ≥': 4,
            '‚òÜ': 5,
            '‚≠êÔ∏é': 6,
            '√ó': 7,
            '√ó√ó': 8,
            'Ê∂à': 9
        };

        // ÂàùÊúüÂåñ
        async function init() {
            try {
                // JSON„Éï„Ç°„Ç§„É´„ÅÆ„É™„Çπ„Éà„ÇíÂèñÂæóÔºàGitHub API„Çí‰ΩøÁî®Ôºâ
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/json?ref=${GITHUB_BRANCH}`);
                if (!response.ok) throw new Error('JSON„Éï„Ç°„Ç§„É´„É™„Çπ„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');

                const files = await response.json();
                const jsonFiles = files.filter(file => file.name.endsWith('.json'));

                // ÂêÑJSON„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
                for (const file of jsonFiles) {
                    const raceName = file.name.replace('.json', '');
                    const jsonResponse = await fetch(`${BASE_URL}/json/${file.name}`);
                    if (jsonResponse.ok) {
                        const jsonData = await jsonResponse.json();
                        racesData[raceName] = jsonData;
                    }
                }

                // „É¨„Éº„Çπ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
                createRaceGroups();

            } catch (error) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                document.getElementById('raceGroups').innerHTML =
                    '<div class="error">„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„É™„Éù„Ç∏„Éà„É™Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</div>';
            }
        }

        // „É¨„Éº„ÇπÂêç„Åã„ÇâÂ†¥ÊâÄ„Å®Áï™Âè∑„ÇíÊäΩÂá∫
        function parseRaceName(raceName) {
            const match = raceName.match(/^(.+?)(\d+)R$/);
            if (match) {
                return {
                    place: match[1],
                    number: parseInt(match[2])
                };
            }
            return null;
        }

        // „É¨„Éº„Çπ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
        function createRaceGroups() {
            const groupsContainer = document.getElementById('raceGroups');
            groupsContainer.innerHTML = '';

            // „É¨„Éº„Çπ„ÇíÂ†¥ÊâÄ„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const racesByPlace = {};
            Object.keys(racesData).forEach(raceName => {
                const parsed = parseRaceName(raceName);
                if (parsed) {
                    if (!racesByPlace[parsed.place]) {
                        racesByPlace[parsed.place] = [];
                    }
                    racesByPlace[parsed.place].push({
                        name: raceName,
                        number: parsed.number
                    });
                }
            });

            // Â†¥ÊâÄ„Çí„ÇΩ„Éº„Éà
            const places = Object.keys(racesByPlace).sort();

            if (places.length === 0) {
                groupsContainer.innerHTML = '<div class="error">„É¨„Éº„Çπ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            // ÂêÑÂ†¥ÊâÄ„ÅÆ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
            places.forEach((place, placeIndex) => {
                const group = document.createElement('div');
                group.className = 'race-group';

                const header = document.createElement('div');
                header.className = 'race-group-header';
                header.textContent = place;

                const items = document.createElement('div');
                items.className = 'race-group-items';

                // „É¨„Éº„ÇπÁï™Âè∑„Åß„ÇΩ„Éº„Éà
                const races = racesByPlace[place].sort((a, b) => a.number - b.number);

                races.forEach((race, index) => {
                    const button = document.createElement('button');
                    button.className = 'race-tab-button';
                    button.textContent = race.name;
                    button.onclick = () => selectRace(race.name);

                    // ÊúÄÂàù„ÅÆÂ†¥ÊâÄ„ÅÆÊúÄÂàù„ÅÆ„É¨„Éº„Çπ„ÇíÈÅ∏Êäû
                    if (placeIndex === 0 && index === 0) {
                        button.classList.add('active');
                        selectRace(race.name);
                    }

                    items.appendChild(button);
                });

                group.appendChild(header);
                group.appendChild(items);
                groupsContainer.appendChild(group);
            });
        }

        // „É¨„Éº„Çπ„ÇíÈÅ∏Êäû
        async function selectRace(raceName) {
            currentRace = raceName;

            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„Éñ„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.race-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === raceName) {
                    btn.classList.add('active');
                }
            });

            await displayRaceContent();
        }

        // „É¨„Éº„Çπ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
        async function displayRaceContent() {
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = '<div class="loading">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>';

            try {
                // „Çµ„Éñ„Çø„Éñ„Çí‰ΩúÊàê
                const subTabsHtml = `
                    <div class="sub-tabs">
                        <button class="sub-tab-button ${currentSubTab === 'ability' ? 'active' : ''}"
                                onclick="switchSubTab('ability')">ËÉΩÂäõÈ†Ü</button>
                        <button class="sub-tab-button ${currentSubTab === 'value' ? 'active' : ''}"
                                onclick="switchSubTab('value')">ÊúüÂæÖÂÄ§È†Ü</button>
                    </div>
                `;

                // JSON„Éá„Éº„Çø„Åã„Çâ„Çµ„Éû„É™„Éº„Çí‰ΩúÊàê
                const jsonData = racesData[currentRace];
                const summaryHtml = createSummary(jsonData, currentSubTab);

                // HTML„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
                const htmlResponse = await fetch(`${BASE_URL}/html/${currentRace}.html`);
                let htmlContent = '';

                if (htmlResponse.ok) {
                    htmlContent = await htmlResponse.text();
                    // HTML„ÅÆbody„Çø„Ç∞ÂÜÖ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊäΩÂá∫
                    const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*)<\/body>/i);
                    if (bodyMatch) {
                        htmlContent = bodyMatch[1];
                    }
                }

                // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
                contentArea.innerHTML = subTabsHtml + summaryHtml + '<div class="html-content">' + htmlContent + '</div>';

            } catch (error) {
                console.error('„É¨„Éº„ÇπÊÉÖÂ†±„ÅÆË°®Á§∫„Ç®„É©„Éº:', error);
                contentArea.innerHTML = '<div class="error">„É¨„Éº„ÇπÊÉÖÂ†±„ÅÆË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>';
            }
        }

        // „Çµ„Éñ„Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà
        function switchSubTab(tab) {
            currentSubTab = tab;
            displayRaceContent();
        }

        // „Éà„É©„ÉÉ„ÇØÈÅ©ÊÄß„ÅÆË°®Á§∫„ÉÜ„Ç≠„Çπ„Éà
        function getTrackAptitudeText(value) {
            const texts = ['‰Ωé', 'ÊôÆÈÄö', 'È´ò', 'ÊúÄÈ´ò'];
            return texts[value] || '-';
        }

        // „Çµ„Éû„É™„Éº„Çí‰ΩúÊàê
        function createSummary(jsonData, sortType) {
            if (!jsonData || !jsonData.horses) return '';

            const horses = [...jsonData.horses];

            // „ÇΩ„Éº„ÉàÂá¶ÁêÜ
            horses.sort((a, b) => {
                const markField = sortType === 'ability' ? 'mark' : 'investment_mark';
                const aPriority = markPriority[a[markField]] || 999;
                const bPriority = markPriority[b[markField]] || 999;

                if (aPriority !== bPriority) {
                    return aPriority - bPriority;
                }

                // Âêå„ÅòÂç∞„ÅÆÂ†¥Âêà„ÅØ„Çπ„Ç≥„Ç¢„Åß„ÇΩ„Éº„Éà
                return b.score - a.score;
            });

            let html = `
                <div class="summary-section">
                    <div class="summary-title">
                        ${sortType === 'ability' ? 'ËÉΩÂäõÈ†Ü' : 'ÊúüÂæÖÂÄ§È†Ü'}ÂàÜÊûê
                    </div>
                    <div class="summary-grid">
            `;

            horses.forEach((horse, index) => {
                const markField = sortType === 'ability' ? 'mark' : 'investment_mark';
                const mark = horse[markField];

                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÅÖÂª∂„ÇíË®≠ÂÆö
                const delay = index * 0.05;

                html += `
                    <div class="summary-card" style="animation-delay: ${delay}s">
                        <div class="card-header">
                            <div class="horse-info">
                                <div class="horse-number">${horse.horse_number}</div>
                                <div class="horse-name">${horse.name}</div>
                            </div>
                            ${mark ? `<div class="mark-badge mark-${mark}">${mark}</div>` : ''}
                        </div>

                        <div class="horse-stats">
                            <div class="stat-group">
                                <div class="stat-group-title">Âü∫Êú¨ÊÉÖÂ†±</div>
                                <div class="stat-item">
                                    <span class="stat-label">‰∫∫Ê∞ó</span>
                                    <span class="stat-value popularity-value">${horse.popularity}Áï™‰∫∫Ê∞ó</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">„Ç™„ÉÉ„Ç∫</span>
                                    <span class="stat-value odds-value">${horse.odds || '-'}ÂÄç</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">„Çπ„Ç≥„Ç¢</div>
                                <div class="stat-item">
                                    <span class="stat-label">Á∑èÂêà„Çπ„Ç≥„Ç¢</span>
                                    <span class="stat-value score-value">${horse.score ? horse.score.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Á∑èÂêà„Éù„Ç§„É≥„Éà</span>
                                    <span class="stat-value">${horse.total_points ? horse.total_points.toFixed(2) : '-'}</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</div>
                                <div class="stat-item">
                                    <span class="stat-label">‰∏ä„Çä3FÂπ≥Âùá</span>
                                    <span class="stat-value">${horse['‰∏ä„Çä3FÂπ≥Âùá'] || '-'}Áßí</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Ave-3FÂπ≥Âùá</span>
                                    <span class="stat-value">${horse['Ave-3FÂπ≥Âùá'] || '-'}Áßí</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">PCIÂπ≥Âùá</span>
                                    <span class="stat-value">${horse['PCIÂπ≥Âùá'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">3FÂú∞ÁÇπÂ∑Æ</span>
                                    <span class="stat-value">${horse['-3FÂ∑ÆÂπ≥Âùá'] || '-'}Áßí</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">ÈÅ©ÊÄß„ÉªÊäïË≥á‰æ°ÂÄ§</div>
                                <div class="stat-item">
                                    <span class="stat-label">ÊÉ≥ÂÆöËÑöË≥™</span>
                                    <span class="stat-value">${horse['ÊÉ≥ÂÆöËÑöË≥™'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">„Éà„É©„ÉÉ„ÇØÈÅ©ÊÄß</span>
                                    <span class="stat-value track-aptitude-${horse.track_aptitude}">
                                        ${getTrackAptitudeText(horse.track_aptitude)}
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Âπ≥ÂùáÁùÄÂ∑Æ</span>
                                    <span class="stat-value">${horse.avg_margin != null ? horse.avg_margin.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">„Éê„Ç§„Ç¢„ÇπÈÅ©ÊÄß</span>
                                    <span class="stat-value">${horse.track_bias_aptitude_score != null ? horse.track_bias_aptitude_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ÊäïË≥á‰æ°ÂÄ§</span>
                                    <span class="stat-value">${horse.investment_value_score != null ? horse.investment_value_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ÊäïË≥áË©ï‰æ°</span>
                                    <span class="stat-value">${horse.investment_rating != null ? horse.investment_rating.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ÂÆâÂÆöÊÄß</span>
                                    <span class="stat-value">${horse.stability_score || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // „Ç∞„É≠„Éº„Éê„É´„Å´Èñ¢Êï∞„ÇíÂÖ¨Èñã
        window.switchSubTab = switchSubTab;

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
