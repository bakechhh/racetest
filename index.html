<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç«¶é¦¬å‡ºé¦¬è¡¨ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</title>
    <style>
        /* ãƒªã‚»ãƒƒãƒˆã¨ãƒ™ãƒ¼ã‚¹è¨­å®š */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            background-color: #f0f2f5;
            color: #1a1a1a;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
        body.dark-mode {
            background-color: #1a1d29;
            color: #e0e0e0;
        }

        body.dark-mode .header {
            background: linear-gradient(135deg, #0f1419 0%, #1a1d29 100%);
        }

        body.dark-mode .race-selector,
        body.dark-mode .content-area,
        body.dark-mode .stat-group,
        body.dark-mode .filter-section,
        body.dark-mode .quick-view-section,
        body.dark-mode .comparison-section {
            background: #2a2d3a;
            color: #e0e0e0;
        }

        body.dark-mode .race-group {
            border-color: #3a3d4a;
        }

        body.dark-mode .race-group-header {
            background: #3a3d4a;
            border-color: #4a4d5a;
        }

        body.dark-mode .race-tab-button {
            background: #2a2d3a;
            color: #e0e0e0;
            border-color: #4a4d5a;
        }

        body.dark-mode .summary-card {
            background: #3a3d4a;
        }

        body.dark-mode .sub-tabs {
            background: #2a2d3a;
            border-color: #3a3d4a;
        }

        /* ã‚³ãƒ³ãƒ†ãƒŠ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .container {
            width: 100%;
            max-width: 100%;
            padding: 0 10px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 2px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 12px;
            opacity: 0.9;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .header-controls {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .theme-toggle:active {
            transform: scale(0.9);
        }

        /* ãƒ¬ãƒ¼ã‚¹é¸æŠã‚¨ãƒªã‚¢ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .race-selector {
            background: white;
            margin: 10px 0;
            padding: 15px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .race-selector-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .race-selector-title::before {
            content: "ğŸ‡";
            font-size: 16px;
        }

        /* ãƒ¬ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .race-groups {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .race-group {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .race-group-header {
            background: #f8f9fa;
            padding: 8px 12px;
            font-weight: 600;
            color: #495057;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
        }

        .race-group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 8px;
        }

        .race-tab-button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex: 0 0 auto;
        }

        .race-tab-button:active {
            transform: scale(0.95);
        }

        .race-tab-button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .content-area {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 15px;
        }

        /* ã‚µãƒ–ã‚¿ãƒ– - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .sub-tabs {
            background: #f8f9fa;
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .sub-tab-button {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .sub-tab-button.active {
            color: #2c3e50;
            background: white;
        }

        .sub-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .filter-section {
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 150px;
        }

        .filter-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .filter-button {
            padding: 4px 10px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 12px;
            font-size: 11px;
            transition: all 0.2s ease;
        }

        .filter-button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .sort-select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            background: white;
            cursor: pointer;
            width: 100%;
        }

        /* ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .quick-view-section {
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .quick-view-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .view-mode-buttons {
            display: flex;
            gap: 5px;
        }

        .view-mode-button {
            padding: 4px 8px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 4px;
            font-size: 11px;
        }

        .view-mode-button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        .quick-view-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 12px;
        }

        .quick-view-table th {
            background: #f8f9fa;
            padding: 6px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
        }

        .quick-view-table td {
            padding: 6px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }

        .quick-view-table .horse-name-cell {
            text-align: left;
            font-weight: 500;
        }

        /* æ¯”è¼ƒæ©Ÿèƒ½ */
        .comparison-section {
            display: none;
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-section.active {
            display: block;
        }

        .comparison-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .comparison-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .compare-button {
            padding: 6px 12px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            cursor: pointer;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .compare-button.active {
            background: #3498db;
            color: white;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            overflow-x: auto;
            display: block;
        }

        .comparison-table th {
            background: #f8f9fa;
            padding: 6px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            left: 0;
            z-index: 1;
        }

        .comparison-table td {
            padding: 6px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }

        .comparison-table .metric-name {
            background: #f8f9fa;
            position: sticky;
            left: 0;
            font-weight: 600;
            text-align: left;
        }

        /* ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ– */
        .chart-section {
            padding: 15px;
            background: white;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin-bottom: 20px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 5px;
            padding: 10px 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 30px;
        }

        .bar {
            width: 25px;
            background: #3498db;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .bar-label {
            font-size: 10px;
            margin-top: 5px;
            color: #6c757d;
        }

        .bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: 600;
            color: #333;
        }

        /* å°ã®åˆ†å¸ƒ */
        .mark-distribution {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .mark-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            min-width: 60px;
        }

        .mark-stat-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mark-stat-count {
            font-size: 14px;
            font-weight: 700;
            color: #333;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ */
        .loading, .error {
            text-align: center;
            padding: 40px 20px;
            font-size: 14px;
        }

        .loading {
            color: #6c757d;
        }

        .loading::before {
            content: "â³ ";
            font-size: 20px;
        }

        .error {
            background: #dc3545;
            color: white;
            border-radius: 6px;
            margin: 10px;
        }

        /* ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .summary-section {
            padding: 15px 10px;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-title::before {
            content: "ğŸ“Š";
            font-size: 18px;
        }

        /* é¦¬ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .summary-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* é¦¬ã‚«ãƒ¼ãƒ‰ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .summary-card {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
        }

        .summary-card:active {
            transform: scale(0.98);
        }

        .summary-card.selected-for-compare {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .compare-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            z-index: 10;
        }

        /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .horse-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .horse-number {
            background: rgba(255,255,255,0.2);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .horse-name {
            font-size: 16px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            word-break: keep-all;
            overflow-wrap: break-word;
        }

        /* å°ãƒãƒƒã‚¸ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .mark-badge {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .mark-â— { background: #ff4757; color: white; }
        .mark-â—‹ { background: #00d2d3; color: white; }
        .mark-â–² { background: #54a0ff; color: white; }
        .mark-â–³ { background: #48dbfb; color: white; }
        .mark-â˜† { background: #feca57; color: #2c3e50; }
        .mark-â­ï¸ { background: #ff9ff3; color: white; }
        .mark-Ã— { background: #ee5a6f; color: white; }
        .mark-æ¶ˆ { background: #a4b0be; color: white; }

        /* é¦¬æƒ…å ±çµ±è¨ˆ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .horse-stats {
            padding: 12px;
            display: grid;
            gap: 10px;
            grid-template-columns: 1fr;
        }

        .horse-stats.compact {
            display: none;
        }

        .stat-group {
            background: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .stat-group-title {
            font-size: 10px;
            font-weight: 700;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 3px 0;
            font-size: 12px;
        }

        .stat-label {
            color: #6c757d;
            flex: 1;
            min-width: 0;
            padding-right: 8px;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
            flex-shrink: 0;
            text-align: right;
        }

        /* ç‰¹åˆ¥ãªå€¤ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .odds-value { color: #e74c3c; }
        .score-value {
            color: #3498db;
            font-size: 18px;
            font-weight: 700;
        }
        .popularity-value { color: #27ae60; }

        .track-aptitude-0 { color: #95a5a6; }
        .track-aptitude-1 { color: #3498db; }
        .track-aptitude-2 { color: #27ae60; font-weight: 600; }
        .track-aptitude-3 {
            color: #e74c3c;
            font-weight: 700;
        }

        /* HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .html-content {
            padding: 10px;
            border-top: 2px solid #e9ecef;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .html-content table {
            width: 100%;
            min-width: 500px;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-radius: 6px;
            overflow: hidden;
        }

        .html-content th {
            background: #2c3e50;
            color: white;
            padding: 6px 4px;
            text-align: center;
            font-weight: 600;
            font-size: 9px;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .html-content td {
            padding: 4px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            background: white;
            font-size: 9px;
            white-space: nowrap;
        }

        /* æ ç•ªã®è‰² */
        .html-content .frame-1 { background: #fff; color: #000; border: 2px solid #000; }
        .html-content .frame-2 { background: #000; color: #fff; }
        .html-content .frame-3 { background: #f44336; color: #fff; }
        .html-content .frame-4 { background: #2196f3; color: #fff; }
        .html-content .frame-5 { background: #ffeb3b; color: #000; }
        .html-content .frame-6 { background: #4caf50; color: #fff; }
        .html-content .frame-7 { background: #ff9800; color: #fff; }
        .html-content .frame-8 { background: #e91e63; color: #fff; }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .html-content .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #2c3e50;
            margin: 20px 0 10px;
            padding-left: 10px;
            border-left: 3px solid #3498db;
        }

        /* ãƒã‚¤ã‚¢ã‚¹æƒ…å ±ç­‰ã®ãƒœãƒƒã‚¯ã‚¹ - ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
        .html-content .lower-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .html-content .bias-info,
        .html-content .score-info,
        .html-content .ranking {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ */
        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
            z-index: 90;
            transition: all 0.3s ease;
        }

        .scroll-to-top.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-to-top:active {
            transform: scale(0.9);
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã‚¨ãƒªã‚¢ã®è¡¨ç¤º */
        .scroll-hint {
            display: none;
            text-align: center;
            font-size: 10px;
            color: #6c757d;
            padding: 5px;
            background: rgba(255,255,255,0.9);
            position: sticky;
            left: 0;
            margin-top: -5px;
        }

        .html-content::-webkit-scrollbar {
            height: 4px;
        }

        .html-content::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .html-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 2px;
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container {
                max-width: 768px;
                margin: 0 auto;
                padding: 0 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .summary-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .horse-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-controls {
                flex-direction: row;
            }

            .bar-chart {
                gap: 10px;
            }

            .bar {
                width: 35px;
            }
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œ */
        @media (min-width: 1025px) {
            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 20px;
            }

            .header {
                padding: 30px 0;
            }

            .header h1 {
                font-size: 28px;
                margin-bottom: 5px;
            }

            .header p {
                font-size: 14px;
            }

            .race-selector {
                padding: 20px;
                margin: 20px 0;
            }

            .race-selector-title {
                font-size: 16px;
                margin-bottom: 15px;
            }

            .race-groups {
                display: grid;
                gap: 15px;
            }

            .race-tab-button {
                padding: 8px 16px;
                font-size: 13px;
                border-radius: 20px;
            }

            .race-tab-button:hover {
                background: #3498db;
                color: white;
                border-color: #3498db;
                transform: scale(1.05);
            }

            .summary-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
                gap: 20px;
            }

            .summary-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.12);
                border-color: #3498db;
            }

            .horse-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .html-content {
                padding: 20px;
            }

            .html-content table {
                font-size: 12px;
            }

            .html-content th,
            .html-content td {
                padding: 8px;
            }

            .html-content .lower-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }

            .filter-controls {
                flex-direction: row;
            }

            .bar-chart {
                gap: 15px;
            }

            .bar {
                width: 40px;
            }
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .summary-card {
            animation: fadeIn 0.3s ease;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¿ãƒƒãƒæ“ä½œæ”¹å–„ */
        @media (hover: none) and (pointer: coarse) {
            .race-tab-button,
            .sub-tab-button,
            .filter-button,
            .compare-button {
                -webkit-tap-highlight-color: rgba(52, 152, 219, 0.2);
            }
        }

        /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ãƒ’ãƒ³ãƒˆè¡¨ç¤º */
        @media (max-width: 767px) {
            .html-content {
                position: relative;
            }

            .html-content table {
                display: block;
            }

            .scroll-hint {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="header-content">
                <h1>ç«¶é¦¬å‡ºé¦¬è¡¨ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</h1>
                <p>AIã‚¹ã‚³ã‚¢åˆ†æ & è©³ç´°ãƒ‡ãƒ¼ã‚¿</p>
                <div class="header-controls">
                    <button class="theme-toggle" onclick="toggleTheme()" title="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">
                        <span id="themeIcon">ğŸŒ™</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="race-selector">
            <div class="race-selector-title">ãƒ¬ãƒ¼ã‚¹é¸æŠ</div>
            <div class="race-groups" id="raceGroups">
                <div class="loading">ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>

        <div class="content-area" id="content">
            <div class="loading">ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        </div>
    </div>

    <button class="scroll-to-top" onclick="scrollToTop()" title="ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹">â†‘</button>

    <script>
        // GitHub Pagesã®è¨­å®š
        const GITHUB_REPO = 'bakechhh/racetest'; // ã“ã“ã‚’å®Ÿéš›ã®ãƒªãƒã‚¸ãƒˆãƒªã«å¤‰æ›´
        const GITHUB_BRANCH = 'main'; // ã¾ãŸã¯ 'master'
        const BASE_URL = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}`;

        // ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
        let racesData = {};
        let currentRace = null;
        let currentSubTab = 'ability'; // 'ability' or 'value'
        let currentFilters = {
            marks: [],
            sortBy: 'default'
        };
        let selectedForCompare = [];
        let isComparisonMode = false;
        let quickViewMode = 'ability';

        // å°ã®å„ªå…ˆé †ä½
        const markPriority = {
            'â—': 1,
            'â—‹': 2,
            'â–²': 3,
            'â–³': 4,
            'â˜†': 5,
            'â­ï¸': 6,
            'Ã—': 7,
            'Ã—Ã—': 8,
            'æ¶ˆ': 9
        };

        // åˆæœŸåŒ–
        async function init() {
            try {
                // JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆGitHub APIã‚’ä½¿ç”¨ï¼‰
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/json?ref=${GITHUB_BRANCH}`);
                if (!response.ok) throw new Error('JSONãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');

                const files = await response.json();
                const jsonFiles = files.filter(file => file.name.endsWith('.json'));

                // å„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
                for (const file of jsonFiles) {
                    const raceName = file.name.replace('.json', '');
                    const jsonResponse = await fetch(`${BASE_URL}/json/${file.name}`);
                    if (jsonResponse.ok) {
                        const jsonData = await jsonResponse.json();
                        racesData[raceName] = jsonData;
                    }
                }

                // ãƒ¬ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
                createRaceGroups();

                // ãƒ†ãƒ¼ãƒã‚’å¾©å…ƒ
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeIcon').textContent = 'â˜€ï¸';
                }

            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('raceGroups').innerHTML =
                    '<div class="error">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        // ãƒ¬ãƒ¼ã‚¹åã‹ã‚‰å ´æ‰€ã¨ç•ªå·ã‚’æŠ½å‡º
        function parseRaceName(raceName) {
            const match = raceName.match(/^(.+?)(\d+)R$/);
            if (match) {
                return {
                    place: match[1],
                    number: parseInt(match[2])
                };
            }
            return null;
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
        function createRaceGroups() {
            const groupsContainer = document.getElementById('raceGroups');
            groupsContainer.innerHTML = '';

            // ãƒ¬ãƒ¼ã‚¹ã‚’å ´æ‰€ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const racesByPlace = {};
            Object.keys(racesData).forEach(raceName => {
                const parsed = parseRaceName(raceName);
                if (parsed) {
                    if (!racesByPlace[parsed.place]) {
                        racesByPlace[parsed.place] = [];
                    }
                    racesByPlace[parsed.place].push({
                        name: raceName,
                        number: parsed.number
                    });
                }
            });

            // å ´æ‰€ã‚’ã‚½ãƒ¼ãƒˆ
            const places = Object.keys(racesByPlace).sort();

            if (places.length === 0) {
                groupsContainer.innerHTML = '<div class="error">ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            // å„å ´æ‰€ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
            places.forEach((place, placeIndex) => {
                const group = document.createElement('div');
                group.className = 'race-group';

                const header = document.createElement('div');
                header.className = 'race-group-header';
                header.textContent = place;

                const items = document.createElement('div');
                items.className = 'race-group-items';

                // ãƒ¬ãƒ¼ã‚¹ç•ªå·ã§ã‚½ãƒ¼ãƒˆ
                const races = racesByPlace[place].sort((a, b) => a.number - b.number);

                races.forEach((race, index) => {
                    const button = document.createElement('button');
                    button.className = 'race-tab-button';
                    button.textContent = race.name;
                    button.onclick = () => selectRace(race.name);

                    // æœ€åˆã®å ´æ‰€ã®æœ€åˆã®ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ
                    if (placeIndex === 0 && index === 0) {
                        button.classList.add('active');
                        selectRace(race.name);
                    }

                    items.appendChild(button);
                });

                group.appendChild(header);
                group.appendChild(items);
                groupsContainer.appendChild(group);
            });
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ
        async function selectRace(raceName) {
            currentRace = raceName;
            currentFilters = { marks: [], sortBy: 'default' };
            selectedForCompare = [];
            isComparisonMode = false;

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã‚’æ›´æ–°
            document.querySelectorAll('.race-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === raceName) {
                    btn.classList.add('active');
                }
            });

            await displayRaceContent();
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
        async function displayRaceContent() {
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';

            try {
                // ã‚µãƒ–ã‚¿ãƒ–ã‚’ä½œæˆ
                const subTabsHtml = `
                    <div class="sub-tabs">
                        <button class="sub-tab-button ${currentSubTab === 'ability' ? 'active' : ''}"
                                onclick="switchSubTab('ability')">èƒ½åŠ›é †</button>
                        <button class="sub-tab-button ${currentSubTab === 'value' ? 'active' : ''}"
                                onclick="switchSubTab('value')">æœŸå¾…å€¤é †</button>
                    </div>
                `;

                // JSONãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const jsonData = racesData[currentRace];

                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                const filterHtml = createFilterSection(jsonData);

                // ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                const quickViewHtml = createQuickViewSection(jsonData);

                // æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³
                const comparisonHtml = createComparisonSection();

                // ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                const chartHtml = createChartSection(jsonData);

                // ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                const summaryHtml = createSummary(jsonData, currentSubTab);

                // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
                const htmlResponse = await fetch(`${BASE_URL}/html/${currentRace}.html`);
                let htmlContent = '';

                if (htmlResponse.ok) {
                    htmlContent = await htmlResponse.text();
                    // HTMLã®bodyã‚¿ã‚°å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŠ½å‡º
                    const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*)<\/body>/i);
                    if (bodyMatch) {
                        htmlContent = bodyMatch[1];
                    }
                }

                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
                contentArea.innerHTML = subTabsHtml + filterHtml + quickViewHtml + 
                    comparisonHtml + chartHtml + summaryHtml + 
                    '<div class="html-content">' + 
                    '<div class="scroll-hint">â† æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å…¨ä½“ã‚’è¡¨ç¤º â†’</div>' +
                    htmlContent + '</div>';

            } catch (error) {
                console.error('ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã®è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                contentArea.innerHTML = '<div class="error">ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        function createFilterSection(jsonData) {
            const marks = ['â—', 'â—‹', 'â–²', 'â–³', 'â˜†', 'â­ï¸', 'Ã—', 'æ¶ˆ'];
            
            return `
                <div class="filter-section">
                    <div class="filter-title">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ & ã‚½ãƒ¼ãƒˆ</div>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <div class="filter-label">å°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
                            <div class="filter-buttons">
                                ${marks.map(mark => `
                                    <button class="filter-button mark-filter" data-mark="${mark}"
                                            onclick="toggleMarkFilter('${mark}')">
                                        ${mark}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div class="filter-group">
                            <div class="filter-label">ä¸¦ã³é †</div>
                            <select class="sort-select" onchange="changeSortOrder(this.value)">
                                <option value="default">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</option>
                                <option value="popularity">äººæ°—é †</option>
                                <option value="odds">ã‚ªãƒƒã‚ºé †</option>
                                <option value="score">ã‚¹ã‚³ã‚¢é †</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="compare-button" onclick="toggleComparisonMode()">
                            æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
                        </button>
                        <button class="filter-button" onclick="resetFilters()">
                            ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>
                </div>
            `;
        }

        // ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        function createQuickViewSection(jsonData) {
            return `
                <div class="quick-view-section">
                    <div class="quick-view-title">
                        <span>ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼</span>
                        <div class="view-mode-buttons">
                            <button class="view-mode-button ${quickViewMode === 'ability' ? 'active' : ''}"
                                    onclick="changeQuickViewMode('ability')">èƒ½åŠ›</button>
                            <button class="view-mode-button ${quickViewMode === 'value' ? 'active' : ''}"
                                    onclick="changeQuickViewMode('value')">æœŸå¾…å€¤</button>
                        </div>
                    </div>
                    <div id="quickViewContent">
                        ${createQuickViewTable(jsonData, quickViewMode)}
                    </div>
                </div>
            `;
        }

        // ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
        function createQuickViewTable(jsonData, mode) {
            if (!jsonData || !jsonData.horses) return '';

            const horses = getFilteredAndSortedHorses(jsonData.horses);
            const markField = mode === 'ability' ? 'mark' : 'investment_mark';

            let html = `
                <table class="quick-view-table">
                    <thead>
                        <tr>
                            <th>å°</th>
                            <th>ç•ª</th>
                            <th>é¦¬å</th>
                            <th>äººæ°—</th>
                            <th>ã‚ªãƒƒã‚º</th>
                            <th>ã‚¹ã‚³ã‚¢</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            horses.forEach(horse => {
                const mark = horse[markField];
                html += `
                    <tr>
                        <td>${mark ? `<span class="mark-badge mark-${mark}" style="width: 25px; height: 25px; font-size: 12px;">${mark}</span>` : '-'}</td>
                        <td>${horse.horse_number}</td>
                        <td class="horse-name-cell">${horse.name}</td>
                        <td>${horse.popularity}ç•ª</td>
                        <td>${horse.odds}å€</td>
                        <td>${horse.score.toFixed(2)}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            return html;
        }

        // æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        function createComparisonSection() {
            return `
                <div class="comparison-section" id="comparisonSection">
                    <div class="comparison-title">é¦¬ã®æ¯”è¼ƒ</div>
                    <div id="comparisonContent">
                        <p style="color: #6c757d; font-size: 12px;">æ¯”è¼ƒã—ãŸã„é¦¬ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§3é ­ï¼‰</p>
                    </div>
                </div>
            `;
        }

        // ãƒãƒ£ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        function createChartSection(jsonData) {
            if (!jsonData || !jsonData.horses) return '';

            // å°ã®åˆ†å¸ƒã‚’è¨ˆç®—
            const markCounts = {};
            const marks = ['â—', 'â—‹', 'â–²', 'â–³', 'â˜†', 'â­ï¸', 'Ã—', 'æ¶ˆ'];
            marks.forEach(mark => markCounts[mark] = 0);

            jsonData.horses.forEach(horse => {
                const mark = currentSubTab === 'ability' ? horse.mark : horse.investment_mark;
                if (mark && markCounts.hasOwnProperty(mark)) {
                    markCounts[mark]++;
                }
            });

            return `
                <div class="chart-section">
                    <div class="chart-title">ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–</div>
                    
                    <div style="margin-bottom: 20px;">
                        <div class="chart-title" style="font-size: 13px;">å°ã®åˆ†å¸ƒ</div>
                        <div class="mark-distribution">
                            ${marks.map(mark => `
                                <div class="mark-stat">
                                    <div class="mark-stat-icon mark-${mark}">${mark}</div>
                                    <div class="mark-stat-count">${markCounts[mark]}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div>
                        <div class="chart-title" style="font-size: 13px;">ã‚¹ã‚³ã‚¢åˆ†å¸ƒ</div>
                        <div class="chart-container">
                            <div class="bar-chart" id="scoreChart">
                                ${createScoreChart(jsonData)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ã‚¹ã‚³ã‚¢ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆ
        function createScoreChart(jsonData) {
            const horses = getFilteredAndSortedHorses(jsonData.horses);
            const maxScore = Math.max(...horses.map(h => h.score));

            return horses.map(horse => {
                const height = (horse.score / maxScore) * 100;
                return `
                    <div class="bar-item">
                        <div class="bar" style="height: ${height}%; background: ${getScoreColor(horse.score, maxScore)};">
                            <span class="bar-value">${horse.score.toFixed(0)}</span>
                        </div>
                        <span class="bar-label">${horse.horse_number}</span>
                    </div>
                `;
            }).join('');
        }

        // ã‚¹ã‚³ã‚¢ã«åŸºã¥ã„ã¦è‰²ã‚’å–å¾—
        function getScoreColor(score, maxScore) {
            const ratio = score / maxScore;
            if (ratio > 0.8) return '#e74c3c';
            if (ratio > 0.6) return '#f39c12';
            if (ratio > 0.4) return '#3498db';
            return '#95a5a6';
        }

        // ã‚µãƒ–ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function switchSubTab(tab) {
            currentSubTab = tab;
            quickViewMode = tab;
            displayRaceContent();
        }

        // ãƒˆãƒ©ãƒƒã‚¯é©æ€§ã®è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
        function getTrackAptitudeText(value) {
            const texts = ['ä½', 'æ™®é€š', 'é«˜', 'æœ€é«˜'];
            return texts[value] || '-';
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ã¨ã‚½ãƒ¼ãƒˆ
        function getFilteredAndSortedHorses(horses) {
            let filtered = [...horses];

            // å°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            if (currentFilters.marks.length > 0) {
                const markField = currentSubTab === 'ability' ? 'mark' : 'investment_mark';
                filtered = filtered.filter(horse => 
                    currentFilters.marks.includes(horse[markField])
                );
            }

            // ã‚½ãƒ¼ãƒˆ
            switch (currentFilters.sortBy) {
                case 'popularity':
                    filtered.sort((a, b) => a.popularity - b.popularity);
                    break;
                case 'odds':
                    filtered.sort((a, b) => a.odds - b.odds);
                    break;
                case 'score':
                    filtered.sort((a, b) => b.score - a.score);
                    break;
                default:
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å°ã®å„ªå…ˆé †ä½
                    filtered.sort((a, b) => {
                        const markField = currentSubTab === 'ability' ? 'mark' : 'investment_mark';
                        const aPriority = markPriority[a[markField]] || 999;
                        const bPriority = markPriority[b[markField]] || 999;
                        if (aPriority !== bPriority) {
                            return aPriority - bPriority;
                        }
                        return b.score - a.score;
                    });
            }

            return filtered;
        }

        // ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆ
        function createSummary(jsonData, sortType) {
            if (!jsonData || !jsonData.horses) return '';

            const horses = getFilteredAndSortedHorses(jsonData.horses);

            let html = `
                <div class="summary-section">
                    <div class="summary-title">
                        ${sortType === 'ability' ? 'èƒ½åŠ›é †' : 'æœŸå¾…å€¤é †'}åˆ†æ
                    </div>
                    <div class="summary-grid">
            `;

            horses.forEach((horse, index) => {
                const markField = sortType === 'ability' ? 'mark' : 'investment_mark';
                const mark = horse[markField];

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ã‚’è¨­å®š
                const delay = index * 0.05;

                html += `
                    <div class="summary-card ${selectedForCompare.includes(horse.horse_number) ? 'selected-for-compare' : ''}" 
                         style="animation-delay: ${delay}s"
                         data-horse-number="${horse.horse_number}">
                        ${isComparisonMode ? `<input type="checkbox" class="compare-checkbox" 
                            ${selectedForCompare.includes(horse.horse_number) ? 'checked' : ''}
                            onclick="event.stopPropagation(); toggleCompareSelection(${horse.horse_number})">` : ''}
                        <div class="card-header" onclick="handleCardClick(${horse.horse_number})">
                            <div class="horse-info">
                                <div class="horse-number">${horse.horse_number}</div>
                                <div class="horse-name">${horse.name}</div>
                            </div>
                            ${mark ? `<div class="mark-badge mark-${mark}">${mark}</div>` : ''}
                        </div>

                        <div class="horse-stats">
                            <div class="stat-group">
                                <div class="stat-group-title">åŸºæœ¬æƒ…å ±</div>
                                <div class="stat-item">
                                    <span class="stat-label">äººæ°—</span>
                                    <span class="stat-value popularity-value">${horse.popularity}ç•ªäººæ°—</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ã‚ªãƒƒã‚º</span>
                                    <span class="stat-value odds-value">${horse.odds || '-'}å€</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">ã‚¹ã‚³ã‚¢</div>
                                <div class="stat-item">
                                    <span class="stat-label">ç·åˆã‚¹ã‚³ã‚¢</span>
                                    <span class="stat-value score-value">${horse.score ? horse.score.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ç·åˆãƒã‚¤ãƒ³ãƒˆ</span>
                                    <span class="stat-value">${horse.total_points ? horse.total_points.toFixed(2) : '-'}</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
                                <div class="stat-item">
                                    <span class="stat-label">ä¸Šã‚Š3Få¹³å‡</span>
                                    <span class="stat-value">${horse['ä¸Šã‚Š3Få¹³å‡'] || '-'}ç§’</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Ave-3Få¹³å‡</span>
                                    <span class="stat-value">${horse['Ave-3Få¹³å‡'] || '-'}ç§’</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">PCIå¹³å‡</span>
                                    <span class="stat-value">${horse['PCIå¹³å‡'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">3Fåœ°ç‚¹å·®</span>
                                    <span class="stat-value">${horse['-3Få·®å¹³å‡'] || '-'}ç§’</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">é©æ€§ãƒ»æŠ•è³‡ä¾¡å€¤</div>
                                <div class="stat-item">
                                    <span class="stat-label">æƒ³å®šè„šè³ª</span>
                                    <span class="stat-value">${horse['æƒ³å®šè„šè³ª'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ãƒˆãƒ©ãƒƒã‚¯é©æ€§</span>
                                    <span class="stat-value track-aptitude-${horse.track_aptitude}">
                                        ${getTrackAptitudeText(horse.track_aptitude)}
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">å¹³å‡ç€å·®</span>
                                    <span class="stat-value">${horse.avg_margin != null ? horse.avg_margin.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ãƒã‚¤ã‚¢ã‚¹é©æ€§</span>
                                    <span class="stat-value">${horse.track_bias_aptitude_score != null ? horse.track_bias_aptitude_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">æŠ•è³‡ä¾¡å€¤</span>
                                    <span class="stat-value">${horse.investment_value_score != null ? horse.investment_value_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">æŠ•è³‡è©•ä¾¡</span>
                                    <span class="stat-value">${horse.investment_rating != null ? horse.investment_rating.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">å®‰å®šæ€§</span>
                                    <span class="stat-value">${horse.stability_score || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // å°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒˆã‚°ãƒ«
        function toggleMarkFilter(mark) {
            const index = currentFilters.marks.indexOf(mark);
            if (index > -1) {
                currentFilters.marks.splice(index, 1);
            } else {
                currentFilters.marks.push(mark);
            }
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.mark-filter').forEach(btn => {
                if (btn.dataset.mark === mark) {
                    btn.classList.toggle('active');
                }
            });

            displayRaceContent();
        }

        // ã‚½ãƒ¼ãƒˆé †ã®å¤‰æ›´
        function changeSortOrder(sortBy) {
            currentFilters.sortBy = sortBy;
            displayRaceContent();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒªã‚»ãƒƒãƒˆ
        function resetFilters() {
            currentFilters = { marks: [], sortBy: 'default' };
            displayRaceContent();
        }

        // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã®ãƒˆã‚°ãƒ«
        function toggleComparisonMode() {
            isComparisonMode = !isComparisonMode;
            
            const btn = event.target;
            btn.classList.toggle('active');
            
            const compSection = document.getElementById('comparisonSection');
            if (isComparisonMode) {
                compSection.classList.add('active');
                // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã«å…¥ã£ãŸã‚‰é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
                selectedForCompare = [];
                updateComparisonDisplay();
            } else {
                compSection.classList.remove('active');
                selectedForCompare = [];
            }
            
            // ãƒšãƒ¼ã‚¸ã‚’å†æç”»
            displayRaceContent();
        }

        // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleCardClick(horseNumber) {
            if (isComparisonMode) {
                toggleCompareSelection(horseNumber);
            }
        }

        // æ¯”è¼ƒé¸æŠã®ãƒˆã‚°ãƒ«
        function toggleCompareSelection(horseNumber) {
            const index = selectedForCompare.indexOf(horseNumber);
            if (index > -1) {
                selectedForCompare.splice(index, 1);
            } else if (selectedForCompare.length < 3) {
                selectedForCompare.push(horseNumber);
            } else {
                alert('æ¯”è¼ƒã¯æœ€å¤§3é ­ã¾ã§ã§ã™');
                return;
            }
            
            // ã™ãã«æ¯”è¼ƒè¡¨ç¤ºã‚’æ›´æ–°
            updateComparisonDisplay();
            
            // ã‚«ãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.summary-card').forEach(card => {
                const cardNumber = parseInt(card.querySelector('.horse-number').textContent);
                if (selectedForCompare.includes(cardNumber)) {
                    card.classList.add('selected-for-compare');
                } else {
                    card.classList.remove('selected-for-compare');
                }
            });
            
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.compare-checkbox').forEach(checkbox => {
                const cardNumber = parseInt(checkbox.closest('.summary-card').querySelector('.horse-number').textContent);
                checkbox.checked = selectedForCompare.includes(cardNumber);
            });
        }

        // æ¯”è¼ƒè¡¨ç¤ºã®æ›´æ–°
        function updateComparisonDisplay() {
            const compContent = document.getElementById('comparisonContent');
            if (!compContent) return;

            if (selectedForCompare.length === 0) {
                compContent.innerHTML = '<p style="color: #6c757d; font-size: 12px;">æ¯”è¼ƒã—ãŸã„é¦¬ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§3é ­ï¼‰</p>';
                return;
            }

            const jsonData = racesData[currentRace];
            const selectedHorses = jsonData.horses.filter(h => selectedForCompare.includes(h.horse_number));

            let html = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            ${selectedHorses.map(h => `<th>${h.horse_number}ç•ª<br>${h.name}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="metric-name">äººæ°—</td>
                            ${selectedHorses.map(h => `<td>${h.popularity}ç•ªäººæ°—</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ã‚ªãƒƒã‚º</td>
                            ${selectedHorses.map(h => `<td>${h.odds}å€</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ç·åˆã‚¹ã‚³ã‚¢</td>
                            ${selectedHorses.map(h => `<td style="font-weight: 700; color: #3498db;">${h.score.toFixed(2)}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ä¸Šã‚Š3Få¹³å‡</td>
                            ${selectedHorses.map(h => `<td>${h['ä¸Šã‚Š3Få¹³å‡'] || '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">PCIå¹³å‡</td>
                            ${selectedHorses.map(h => `<td>${h['PCIå¹³å‡'] || '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">æƒ³å®šè„šè³ª</td>
                            ${selectedHorses.map(h => `<td>${h['æƒ³å®šè„šè³ª'] || '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ãƒˆãƒ©ãƒƒã‚¯é©æ€§</td>
                            ${selectedHorses.map(h => `<td>${getTrackAptitudeText(h.track_aptitude)}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">ãƒã‚¤ã‚¢ã‚¹é©æ€§</td>
                            ${selectedHorses.map(h => `<td>${h.track_bias_aptitude_score != null ? h.track_bias_aptitude_score.toFixed(1) : '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">æŠ•è³‡ä¾¡å€¤</td>
                            ${selectedHorses.map(h => `<td>${h.investment_value_score != null ? h.investment_value_score.toFixed(1) : '-'}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="metric-name">å®‰å®šæ€§</td>
                            ${selectedHorses.map(h => `<td>${h.stability_score || '-'}</td>`).join('')}
                        </tr>
                    </tbody>
                </table>
            `;

            compContent.innerHTML = html;
        }

        // ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®å¤‰æ›´
        function changeQuickViewMode(mode) {
            quickViewMode = mode;
            const jsonData = racesData[currentRace];
            document.getElementById('quickViewContent').innerHTML = createQuickViewTable(jsonData, mode);
            
            document.querySelectorAll('.view-mode-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === (mode === 'ability' ? 'èƒ½åŠ›' : 'æœŸå¾…å€¤')) {
                    btn.classList.add('active');
                }
            });
        }

        // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // ãƒˆãƒƒãƒ—ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç›£è¦–
        window.addEventListener('scroll', () => {
            const scrollButton = document.querySelector('.scroll-to-top');
            if (window.pageYOffset > 300) {
                scrollButton.classList.add('visible');
            } else {
                scrollButton.classList.remove('visible');
            }
        });

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«é–¢æ•°ã‚’å…¬é–‹
        window.switchSubTab = switchSubTab;
        window.toggleMarkFilter = toggleMarkFilter;
        window.changeSortOrder = changeSortOrder;
        window.resetFilters = resetFilters;
        window.toggleComparisonMode = toggleComparisonMode;
        window.handleCardClick = handleCardClick;
        window.toggleCompareSelection = toggleCompareSelection;
        window.changeQuickViewMode = changeQuickViewMode;
        window.toggleTheme = toggleTheme;
        window.scrollToTop = scrollToTop;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', init);

        // ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®é«˜ã•ã‚’è¨­å®šï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œï¼‰
        function setViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        setViewportHeight();
        window.addEventListener('resize', setViewportHeight);
    </script>
</body>
</html>
