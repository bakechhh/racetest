<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«¶é¦¬å‡ºé¦¬è¡¨ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</title>
    <style>
        /* ãƒªã‚»ãƒƒãƒˆã¨ãƒ™ãƒ¼ã‚¹è¨­å®š */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            background-color: #f0f2f5;
            color: #1a1a1a;
            line-height: 1.6;
        }

        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ãƒ¬ãƒ¼ã‚¹é¸æŠã‚¨ãƒªã‚¢ */
        .race-selector {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .race-selector-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .race-selector-title::before {
            content: "ğŸ‡";
            font-size: 20px;
        }

        /* ãƒ¬ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— */
        .race-groups {
            display: grid;
            gap: 15px;
        }

        .race-group {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .race-group:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .race-group-header {
            background: #f8f9fa;
            padding: 10px 15px;
            font-weight: 600;
            color: #495057;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        .race-group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
        }

        .race-tab-button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .race-tab-button:hover {
            background: #3498db;
            color: white;
            border-color: #3498db;
            transform: scale(1.05);
        }

        .race-tab-button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
            box-shadow: 0 2px 6px rgba(44, 62, 80, 0.3);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .content-area {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* ã‚µãƒ–ã‚¿ãƒ– */
        .sub-tabs {
            background: #f8f9fa;
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .sub-tab-button {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .sub-tab-button:hover {
            color: #3498db;
            background: rgba(52, 152, 219, 0.05);
        }

        .sub-tab-button.active {
            color: #2c3e50;
            background: white;
        }

        .sub-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ */
        .loading, .error {
            text-align: center;
            padding: 60px 20px;
        }

        .loading {
            color: #6c757d;
        }

        .loading::before {
            content: "â³ ";
            font-size: 24px;
        }

        .error {
            background: #dc3545;
            color: white;
            border-radius: 8px;
            margin: 20px;
        }

        /* ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .summary-section {
            padding: 20px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-title::before {
            content: "ğŸ“Š";
            font-size: 20px;
        }

        /* é¦¬ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        /* é¦¬ã‚«ãƒ¼ãƒ‰ */
        .summary-card {
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border-color: #3498db;
        }

        /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .horse-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .horse-number {
            background: rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .horse-name {
            font-size: 18px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        /* å°ãƒãƒƒã‚¸ */
        .mark-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .mark-â— { background: #ff4757; color: white; }
        .mark-â—‹ { background: #00d2d3; color: white; }
        .mark-â–² { background: #54a0ff; color: white; }
        .mark-â–³ { background: #48dbfb; color: white; }
        .mark-â˜† { background: #feca57; color: #2c3e50; }
        .mark-â­ï¸ { background: #ff9ff3; color: white; }
        .mark-Ã— { background: #ee5a6f; color: white; }
        .mark-æ¶ˆ { background: #a4b0be; color: white; }

        /* é¦¬æƒ…å ±çµ±è¨ˆ */
        .horse-stats {
            padding: 15px;
            display: grid;
            gap: 12px;
        }

        .stat-group {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .stat-group-title {
            font-size: 11px;
            font-weight: 700;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 13px;
        }

        .stat-label {
            color: #6c757d;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
        }

        /* ç‰¹åˆ¥ãªå€¤ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .odds-value { color: #e74c3c; }
        .score-value {
            color: #3498db;
            font-size: 20px;
            font-weight: 700;
        }
        .popularity-value { color: #27ae60; }

        .track-aptitude-0 { color: #95a5a6; }
        .track-aptitude-1 { color: #3498db; }
        .track-aptitude-2 { color: #27ae60; font-weight: 600; }
        .track-aptitude-3 {
            color: #e74c3c;
            font-weight: 700;
            text-shadow: 0 0 3px rgba(231, 76, 60, 0.3);
        }

        /* HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ†ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .html-content {
            padding: 20px;
            border-top: 2px solid #e9ecef;
        }

        /* æ—¢å­˜ã®HTMLå†…ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«æ”¹å–„ */
        .html-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .html-content th {
            background: #2c3e50;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .html-content td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            background: white;
        }

        .html-content tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .html-content tr:hover td {
            background: #e3f2fd;
        }

        /* æ ç•ªã®è‰² */
        .html-content .frame-1 { background: #fff; color: #000; border: 2px solid #000; }
        .html-content .frame-2 { background: #000; color: #fff; }
        .html-content .frame-3 { background: #f44336; color: #fff; }
        .html-content .frame-4 { background: #2196f3; color: #fff; }
        .html-content .frame-5 { background: #ffeb3b; color: #000; }
        .html-content .frame-6 { background: #4caf50; color: #fff; }
        .html-content .frame-7 { background: #ff9800; color: #fff; }
        .html-content .frame-8 { background: #e91e63; color: #fff; }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */
        .html-content .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin: 30px 0 15px;
            padding-left: 15px;
            border-left: 4px solid #3498db;
        }

        /* ãƒã‚¤ã‚¢ã‚¹æƒ…å ±ç­‰ã®ãƒœãƒƒã‚¯ã‚¹ */
        .html-content .lower-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .html-content .bias-info,
        .html-content .score-info,
        .html-content .ranking {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }

            .race-group-items {
                gap: 5px;
            }

            .race-tab-button {
                padding: 6px 12px;
                font-size: 12px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .horse-stats {
                grid-template-columns: 1fr;
            }

            .html-content {
                padding: 10px;
                overflow-x: auto;
            }

            .html-content table {
                font-size: 10px;
                min-width: 600px;
            }

            .html-content th,
            .html-content td {
                padding: 5px;
            }

            .html-content .lower-container {
                grid-template-columns: 1fr;
            }
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .summary-card {
            animation: fadeIn 0.3s ease;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="header-content">
                <h1>ç«¶é¦¬å‡ºé¦¬è¡¨ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</h1>
                <p>AIã‚¹ã‚³ã‚¢åˆ†æ & è©³ç´°ãƒ‡ãƒ¼ã‚¿</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="race-selector">
            <div class="race-selector-title">ãƒ¬ãƒ¼ã‚¹é¸æŠ</div>
            <div class="race-groups" id="raceGroups">
                <div class="loading">ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>

        <div class="content-area" id="content">
            <div class="loading">ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        </div>
    </div>

    <script>
        // GitHub Pagesã®è¨­å®š
        const GITHUB_REPO = 'bakechhh/racetest'; // ã“ã“ã‚’å®Ÿéš›ã®ãƒªãƒã‚¸ãƒˆãƒªã«å¤‰æ›´
        const GITHUB_BRANCH = 'main'; // ã¾ãŸã¯ 'master'
        const BASE_URL = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}`;

        // ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
        let racesData = {};
        let currentRace = null;
        let currentSubTab = 'ability'; // 'ability' or 'value'

        // å°ã®å„ªå…ˆé †ä½
        const markPriority = {
            'â—': 1,
            'â—‹': 2,
            'â–²': 3,
            'â–³': 4,
            'â˜†': 5,
            'â­ï¸': 6,
            'Ã—': 7,
            'Ã—Ã—': 8,
            'æ¶ˆ': 9
        };

        // åˆæœŸåŒ–
        async function init() {
            try {
                // JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆGitHub APIã‚’ä½¿ç”¨ï¼‰
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/json?ref=${GITHUB_BRANCH}`);
                if (!response.ok) throw new Error('JSONãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');

                const files = await response.json();
                const jsonFiles = files.filter(file => file.name.endsWith('.json'));

                // å„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
                for (const file of jsonFiles) {
                    const raceName = file.name.replace('.json', '');
                    const jsonResponse = await fetch(`${BASE_URL}/json/${file.name}`);
                    if (jsonResponse.ok) {
                        const jsonData = await jsonResponse.json();
                        racesData[raceName] = jsonData;
                    }
                }

                // ãƒ¬ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
                createRaceGroups();

            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('raceGroups').innerHTML =
                    '<div class="error">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        // ãƒ¬ãƒ¼ã‚¹åã‹ã‚‰å ´æ‰€ã¨ç•ªå·ã‚’æŠ½å‡º
        function parseRaceName(raceName) {
            const match = raceName.match(/^(.+?)(\d+)R$/);
            if (match) {
                return {
                    place: match[1],
                    number: parseInt(match[2])
                };
            }
            return null;
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
        function createRaceGroups() {
            const groupsContainer = document.getElementById('raceGroups');
            groupsContainer.innerHTML = '';

            // ãƒ¬ãƒ¼ã‚¹ã‚’å ´æ‰€ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const racesByPlace = {};
            Object.keys(racesData).forEach(raceName => {
                const parsed = parseRaceName(raceName);
                if (parsed) {
                    if (!racesByPlace[parsed.place]) {
                        racesByPlace[parsed.place] = [];
                    }
                    racesByPlace[parsed.place].push({
                        name: raceName,
                        number: parsed.number
                    });
                }
            });

            // å ´æ‰€ã‚’ã‚½ãƒ¼ãƒˆ
            const places = Object.keys(racesByPlace).sort();

            if (places.length === 0) {
                groupsContainer.innerHTML = '<div class="error">ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            // å„å ´æ‰€ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
            places.forEach((place, placeIndex) => {
                const group = document.createElement('div');
                group.className = 'race-group';

                const header = document.createElement('div');
                header.className = 'race-group-header';
                header.textContent = place;

                const items = document.createElement('div');
                items.className = 'race-group-items';

                // ãƒ¬ãƒ¼ã‚¹ç•ªå·ã§ã‚½ãƒ¼ãƒˆ
                const races = racesByPlace[place].sort((a, b) => a.number - b.number);

                races.forEach((race, index) => {
                    const button = document.createElement('button');
                    button.className = 'race-tab-button';
                    button.textContent = race.name;
                    button.onclick = () => selectRace(race.name);

                    // æœ€åˆã®å ´æ‰€ã®æœ€åˆã®ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ
                    if (placeIndex === 0 && index === 0) {
                        button.classList.add('active');
                        selectRace(race.name);
                    }

                    items.appendChild(button);
                });

                group.appendChild(header);
                group.appendChild(items);
                groupsContainer.appendChild(group);
            });
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ
        async function selectRace(raceName) {
            currentRace = raceName;

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã‚’æ›´æ–°
            document.querySelectorAll('.race-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === raceName) {
                    btn.classList.add('active');
                }
            });

            await displayRaceContent();
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
        async function displayRaceContent() {
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';

            try {
                // ã‚µãƒ–ã‚¿ãƒ–ã‚’ä½œæˆ
                const subTabsHtml = `
                    <div class="sub-tabs">
                        <button class="sub-tab-button ${currentSubTab === 'ability' ? 'active' : ''}"
                                onclick="switchSubTab('ability')">èƒ½åŠ›é †</button>
                        <button class="sub-tab-button ${currentSubTab === 'value' ? 'active' : ''}"
                                onclick="switchSubTab('value')">æœŸå¾…å€¤é †</button>
                    </div>
                `;

                // JSONãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆ
                const jsonData = racesData[currentRace];
                const summaryHtml = createSummary(jsonData, currentSubTab);

                // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
                const htmlResponse = await fetch(`${BASE_URL}/html/${currentRace}.html`);
                let htmlContent = '';

                if (htmlResponse.ok) {
                    htmlContent = await htmlResponse.text();
                    // HTMLã®bodyã‚¿ã‚°å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŠ½å‡º
                    const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*)<\/body>/i);
                    if (bodyMatch) {
                        htmlContent = bodyMatch[1];
                    }
                }

                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
                contentArea.innerHTML = subTabsHtml + summaryHtml + '<div class="html-content">' + htmlContent + '</div>';

            } catch (error) {
                console.error('ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã®è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                contentArea.innerHTML = '<div class="error">ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        // ã‚µãƒ–ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function switchSubTab(tab) {
            currentSubTab = tab;
            displayRaceContent();
        }

        // ãƒˆãƒ©ãƒƒã‚¯é©æ€§ã®è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
        function getTrackAptitudeText(value) {
            const texts = ['ä½', 'æ™®é€š', 'é«˜', 'æœ€é«˜'];
            return texts[value] || '-';
        }

        // ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆ
        function createSummary(jsonData, sortType) {
            if (!jsonData || !jsonData.horses) return '';

            const horses = [...jsonData.horses];

            // ã‚½ãƒ¼ãƒˆå‡¦ç†
            horses.sort((a, b) => {
                const markField = sortType === 'ability' ? 'mark' : 'investment_mark';
                const aPriority = markPriority[a[markField]] || 999;
                const bPriority = markPriority[b[markField]] || 999;

                if (aPriority !== bPriority) {
                    return aPriority - bPriority;
                }

                // åŒã˜å°ã®å ´åˆã¯ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆ
                return b.score - a.score;
            });

            let html = `
                <div class="summary-section">
                    <div class="summary-title">
                        ${sortType === 'ability' ? 'èƒ½åŠ›é †' : 'æœŸå¾…å€¤é †'}åˆ†æ
                    </div>
                    <div class="summary-grid">
            `;

            horses.forEach((horse, index) => {
                const markField = sortType === 'ability' ? 'mark' : 'investment_mark';
                const mark = horse[markField];

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ã‚’è¨­å®š
                const delay = index * 0.05;

                html += `
                    <div class="summary-card" style="animation-delay: ${delay}s">
                        <div class="card-header">
                            <div class="horse-info">
                                <div class="horse-number">${horse.horse_number}</div>
                                <div class="horse-name">${horse.name}</div>
                            </div>
                            ${mark ? `<div class="mark-badge mark-${mark}">${mark}</div>` : ''}
                        </div>

                        <div class="horse-stats">
                            <div class="stat-group">
                                <div class="stat-group-title">åŸºæœ¬æƒ…å ±</div>
                                <div class="stat-item">
                                    <span class="stat-label">äººæ°—</span>
                                    <span class="stat-value popularity-value">${horse.popularity}ç•ªäººæ°—</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ã‚ªãƒƒã‚º</span>
                                    <span class="stat-value odds-value">${horse.odds || '-'}å€</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">ã‚¹ã‚³ã‚¢</div>
                                <div class="stat-item">
                                    <span class="stat-label">ç·åˆã‚¹ã‚³ã‚¢</span>
                                    <span class="stat-value score-value">${horse.score ? horse.score.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ç·åˆãƒã‚¤ãƒ³ãƒˆ</span>
                                    <span class="stat-value">${horse.total_points ? horse.total_points.toFixed(2) : '-'}</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
                                <div class="stat-item">
                                    <span class="stat-label">ä¸Šã‚Š3Få¹³å‡</span>
                                    <span class="stat-value">${horse['ä¸Šã‚Š3Få¹³å‡'] || '-'}ç§’</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Ave-3Få¹³å‡</span>
                                    <span class="stat-value">${horse['Ave-3Få¹³å‡'] || '-'}ç§’</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">PCIå¹³å‡</span>
                                    <span class="stat-value">${horse['PCIå¹³å‡'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">3Fåœ°ç‚¹å·®</span>
                                    <span class="stat-value">${horse['-3Få·®å¹³å‡'] || '-'}ç§’</span>
                                </div>
                            </div>

                            <div class="stat-group">
                                <div class="stat-group-title">é©æ€§ãƒ»æŠ•è³‡ä¾¡å€¤</div>
                                <div class="stat-item">
                                    <span class="stat-label">æƒ³å®šè„šè³ª</span>
                                    <span class="stat-value">${horse['æƒ³å®šè„šè³ª'] || '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ãƒˆãƒ©ãƒƒã‚¯é©æ€§</span>
                                    <span class="stat-value track-aptitude-${horse.track_aptitude}">
                                        ${getTrackAptitudeText(horse.track_aptitude)}
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">å¹³å‡ç€å·®</span>
                                    <span class="stat-value">${horse.avg_margin != null ? horse.avg_margin.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ãƒã‚¤ã‚¢ã‚¹é©æ€§</span>
                                    <span class="stat-value">${horse.track_bias_aptitude_score != null ? horse.track_bias_aptitude_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">æŠ•è³‡ä¾¡å€¤</span>
                                    <span class="stat-value">${horse.investment_value_score != null ? horse.investment_value_score.toFixed(1) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">æŠ•è³‡è©•ä¾¡</span>
                                    <span class="stat-value">${horse.investment_rating != null ? horse.investment_rating.toFixed(2) : '-'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">å®‰å®šæ€§</span>
                                    <span class="stat-value">${horse.stability_score || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«é–¢æ•°ã‚’å…¬é–‹
        window.switchSubTab = switchSubTab;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
